---
slideinit: "<section markdown=\"1\" data-background=\"../../../../../img/slidebackground.png\"><section markdown=\"1\">"
vertical: "</section><section markdown=\"1\">"
horizontal: "</section></section><section markdown=\"1\" data-background=\"../../../../../img/slidebackground.png\"><section markdown=\"1\">"
layout: post
title: QEå®è·µè¯¦è§£
author: yyyu200
tags: DFT åŸåˆ›
subtitle: ""
category: Blogs
notebookfilename: intro
visualworkflow: true
published: true
theme: beige
trans: cube
---


* TOC
{:toc}

# QEå®è·µè¯¦è§£

## 1. è®¡ç®—åŠå¯¼ä½“SiCçš„èƒ½å¸¦

è®¡ç®—åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š1. ä¼˜åŒ–æ™¶æ ¼å¸¸æ•°ï¼›2. è‡ªæ´½è®¡ç®—ï¼›3. èƒ½å¸¦è®¡ç®—ã€‚

### 1.1 è®¾ç½®ç»“æ„å‚æ•°

ç¢³åŒ–ç¡…SiCæœ‰å¤šç§ç»“æ„ï¼Œè¿™é‡Œé€‰æ‹©äº†æ¯”è¾ƒç®€å•çš„é—ªé”ŒçŸ¿(Zincblende)ç»“æ„ã€‚ä¸‹é¢ä»‹ç»ç»“æ„ä¿¡æ¯çš„è·å–ï¼Œå·²ç»äº†è§£å¯ä»¥ç›´æ¥é˜…è¯»1.2èŠ‚ï¼Œé—ªé”ŒçŸ¿ç»“æ„çš„ç©ºé—´ç¾¤æ˜¯$F \overline{4}3M$ï¼ˆNo. 216ï¼‰ï¼Œå¸ƒæ‹‰ä¼æ ¼å­æ˜¯é¢å¿ƒç«‹æ–¹ï¼ˆFace centered cubicï¼‰ã€‚è®¡ç®—éœ€è¦çŸ¥é“SiCçš„åŸèƒå°ºå¯¸ã€åŸå­åæ ‡å’Œæ™¶æ ¼å¸¸æ•°ï¼Œè¿™äº›å‚æ•°æ˜¯ä»å®éªŒå¾—åˆ°çš„ï¼Œé™¤äº†ä»æ–‡çŒ®è·å–å¤–ï¼Œè¿™é‡Œæ¨èä¸€ä¸ªæ•°æ®åº“[Crystallography Open Database](http://www.crystallography.net/cod/)ï¼ˆCODï¼‰ã€‚æ‰“å¼€CODä¸»é¡µï¼Œç‚¹å‡»å·¦ä¾§çš„"search"ã€‚

<p align="center">
    <img src="../../../../../img/COD_send_search.png" width="300" />
</p>

åœ¨æœç´¢é¡µé¢â€œ1 to 8 elementsâ€ä¸€æ è¾“å…¥Siå’ŒCï¼Œâ€œnumber of distinct elements min and maxâ€ä¸€æ è¾“å…¥2å’Œ2ï¼Œè¡¨ç¤ºæœç´¢Siå’ŒCå…ƒç´ ç»„æˆçš„äºŒå…ƒåŒ–åˆç‰©ï¼Œç‚¹å‡»â€œsendâ€å¼€å§‹æœç´¢ã€‚æœç´¢çš„ç»“æœåŒ…å«äº†æ•°æ®åº“ä¸­çš„SiCäºŒå…ƒåŒ–åˆç‰©çš„å¤šç§ç»„åˆ†åŠç»“æ„ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªç©ºé—´ç¾¤ä¸ºF-43mæ˜¯æˆ‘ä»¬è¦æ‰¾çš„é—ªé”ŒçŸ¿ç»“æ„ï¼Œæ™¶æ ¼å¸¸æ•°ç•¥æœ‰ä¸åŒï¼Œåˆ†åˆ«æ˜¯4.348å’Œ4.358ï¼Œé€‰æ‹©è‡ªå·±å–œæ¬¢çš„ä¸€ä¸ªï¼Œè€ƒè™‘åˆ°åé¢è¦è®¡ç®—æ™¶æ ¼å¸¸æ•°çš„ç†è®ºå€¼ï¼Œè¿™é‡Œçš„é€‰æ‹©æ²¡æœ‰ä»€ä¹ˆå½±å“ã€‚

<p align="center">
    <img src="../../../../../img/COD_search_results.png" width="600" />
</p>

ç‚¹å‡»[CIF](http://www.crystallography.net/cod/1010995.cif)ä¸‹è½½åç¼€ä¸ºcifçš„æ–‡ä»¶ã€‚ç”¨[VESTA](http://www.jp-minerals.org/vesta/en/download.html)æ‰“å¼€ï¼Œï¼ˆæˆ–ä½¿ç”¨å…¶ä»–å¯è§†åŒ–ç¨‹åºï¼Œå¦‚Material Studioç­‰ï¼‰ã€‚åœ¨VESTAä¸­ï¼Œç‚¹å‡»â€œFileâ€â€”â€”â€œExport Dataâ€ï¼Œé€‰æ‹©VASPçš„POSCARæ ¼å¼ï¼Œå°†æ–‡ä»¶ä¿å­˜ä¸ºâ€œSiC.vaspâ€æ–‡ä»¶ã€‚

```
Si C
1.0
        4.3480000496         0.0000000000         0.0000000000
        0.0000000000         4.3480000496         0.0000000000
        0.0000000000         0.0000000000         4.3480000496
   Si    C
    4    4
Direct
     0.000000000         0.000000000         0.000000000
     0.000000000         0.500000000         0.500000000
     0.500000000         0.000000000         0.500000000
     0.500000000         0.500000000         0.000000000
     0.250000000         0.250000000         0.250000000
     0.750000000         0.750000000         0.250000000
     0.750000000         0.250000000         0.750000000
     0.250000000         0.750000000         0.750000000

```
è¿™æ—¶å¾—åˆ°çš„æ–‡ä»¶åŒ…æ‹¬äº†cellå°ºå¯¸ï¼ˆç¬¬3-5è¡Œï¼‰å’ŒåŸå­åæ ‡ï¼ˆç¬¬9-16è¡Œï¼‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¼å…¥cifæ–‡ä»¶å¾—åˆ°æ˜¯æ™¶èƒï¼Œæœ‰å¯èƒ½ä¸æ˜¯åŸèƒï¼Œä¸ºäº†è½¬åŒ–ä¸ºåŸèƒï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯å€ŸåŠ©Material Studioçš„å»ºæ¨¡åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥å‚è€ƒ[è¿™é‡Œè¡¨æ ¼2](../../07/TransCell/#tab2)ï¼Œå¾—åˆ°ä»æ™¶èƒåˆ°åŸèƒçš„è½¬æ¢çŸ©é˜µï¼Œè¾“å…¥VESTAä¸­å¾—åˆ°åŸèƒï¼Œå†ç”¨VESTAè¾“å‡ºPOSCARæ ¼å¼ã€‚åœ¨VESTAä¸­ç‚¹å‡»â€œEditâ€â€”â€”â€œEdit Dataâ€â€”â€”â€œUnit Cellâ€â€”â€”â€œTransformâ€ï¼Œè¾“å…¥è½¬æ¢çŸ©é˜µå¦‚ä¸‹å›¾ã€‚

<p align="center">
    <img src="../../../../../img/transform.png" />
</p>

å¾—åˆ°çš„ç»“æ„æ–‡ä»¶å¦‚ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶æ”¹æˆpw.xè¾“å…¥æ ¼å¼ã€‚
```
Si C
1.0
        3.0745003223         0.0000000000         0.0000000000
        1.5372501612         2.6625953831         0.0000000000
        1.5372501612         0.8875317944         2.5103190013
   Si    C
    1    1
Direct
     0.000000000         0.000000000         0.000000000
     0.250000000         0.250000000         0.250000000
```

é™¤äº†ä¸Šè¿°æ–¹æ³•ï¼Œå°†æ™¶èƒè½¬åŒ–æˆåŸèƒè¿˜å¯å‚è€ƒ[[1]](https://avogadro.cc/docs/building-materials/reducing-crystals-to-primitive-cells/)ï¼Œ[[2]](https://www.researchgate.net/post/How_to_convert_a_conventional_cell_to_a_primitive_cell)ä¸­çš„phononpyï¼Œ[[3]](http://www.cryst.ehu.es/cryst/celltran.html)ï¼Œä»¥åŠMaterial Studioçš„CASTEPè®¡ç®—å‰æ£€æŸ¥åŸèƒçš„åŠŸèƒ½ã€‚

pw.x è¾“å…¥ä¸ç»“æ„æœ‰å…³çš„åŒ…æ‹¬SYSTEMéƒ¨åˆ†çš„
```
ibrav,celldm,nat,ntyp
```
ä»¥åŠATOMIC_POSITIONSå’ŒCELL_PARAMETERSä¸¤éƒ¨åˆ†ã€‚è¿™é‡Œcelldmä»£è¡¨æ™¶æ ¼å¸¸æ•°ï¼Œå•ä½æ˜¯Bohrï¼Œè®¾ç½®ibrav=0ç”¨æˆ·å®šä¹‰cellåŸºçŸ¢é‡ä»¥æ–¹ä¾¿ç»Ÿä¸€vc-relaxå’Œåç»­è®¡ç®—çš„è¾“å…¥æ–‡ä»¶æ ¼å¼ï¼Œcelldm(1) = 1.8897261328856432ï¼Œåˆ™CELL_PARAMETERS (alat)çš„å€¼ä»¥Ã…ä¸ºå•ä½ã€‚åœ¨ç»“æ„é©°è±«è¿‡ç¨‹ä¸­ï¼Œcelldmæ˜¯ä¸å˜çš„ï¼Œè€ŒATOMIC_POSITIONSæ˜¯æ ¹æ®åŠ›è€Œå˜åŒ–çš„ï¼Œå¦‚æœæ˜¯vc-relaxï¼ŒåŸå­åæ ‡æ”¹å˜çš„åŒæ—¶ï¼ŒCELL_PARAMETERSåˆ™æ ¹æ®åº”åŠ›è€Œå˜åŒ–ã€‚


### 1.2 ç»“æ„å¼›è±«çš„è¾“å…¥æ–‡ä»¶
pw.xå¤„ç†çš„è®¡ç®—åŒ…æ‹¬ä»¥ä¸‹7ç§ç±»å‹ï¼Œåœ¨è¾“å…¥æ–‡ä»¶ä¸­ç”¨`calculation`è®¾ç½®ï¼š

'scf'ï¼šè‡ªæ´½è®¡ç®—ï¼Œself-consistent fieldï¼Œé€šè¿‡è¿­ä»£çš„æ–¹å¼æ•°å€¼æ±‚è§£å¾®åˆ†-ç§¯åˆ†æ–¹ç¨‹ï¼ˆKohn-Shamæ–¹ç¨‹ï¼‰ï¼Œè¿­ä»£æ”¶æ•›ä»¥ç”µè·çš„å˜åŒ–è¶³å¤Ÿå°ä¸ºå‡†ï¼Œæœ€ç»ˆå¾—åˆ°è‡ªæ´½ç”µè·ã€‚

'nscf'ï¼šéè‡ªæ´½è®¡ç®—ï¼Œscfè®¡ç®—å¸¸åœ¨kç©ºé—´çš„ç½‘æ ¼ä¸Šè¿›è¡Œï¼Œç½‘æ ¼è¦è¶³å¤Ÿå¯†ä»¥å®Œæˆkç©ºé—´ä¸Šçš„ç§¯åˆ†ï¼Œåœ¨DOSç­‰è®¡ç®—éœ€è¦æ›´å¯†çš„kç‚¹ï¼Œè¿™æ—¶åœ¨è‡ªæ´½ç”µè·åŸºç¡€ä¸Šï¼Œè®¡ç®—è¿™äº›æ›´å¤šçš„kç‚¹ï¼Œnscfè®¡ç®—ä¿æŒè‡ªæ´½ç”µè·ä¸å˜ã€‚

'bands'ï¼šä¹Ÿæ˜¯ä¸€ç§nscfè®¡ç®—ï¼Œkç‚¹æŒ‰ç…§ä¸‰ç»´kç©ºé—´ä¸­çš„ç‰¹æ®Šè·¯å¾„é€‰å–ã€‚

'relax'ï¼šä¸€ç³»åˆ—scfè®¡ç®—ï¼Œé€šè¿‡Hellman-FeynmanåŠ›è®¡ç®—ç¦»å­åæ ‡é©°è±«ï¼ˆé€šè¿‡ä¼˜åŒ–ç®—æ³•æ‰¾åˆ°æ€»èƒ½æå°å€¼ç‚¹ï¼‰ï¼Œrelaxè®¡ç®—æ—¶å›ºå®šcellä¸å˜ã€‚

'vc-relax': å…è®¸cellå˜åŒ–çš„relaxï¼Œé€šè¿‡åº”åŠ›çš„è®¡ç®—æ”¹å˜cellã€‚

'md'ï¼šåˆ†å­åŠ¨åŠ›å­¦ï¼Œå°†ç”µå­å¯¹ç¦»å­çš„ä½œç”¨çœ‹æˆç¦»å­æ„Ÿå—åˆ°çš„åŠ¿ï¼Œè·Ÿæ®åŠ¿èƒ½å’Œç¦»å­åˆå§‹é€Ÿåº¦æ±‚è§£ç¦»å­è¿åŠ¨çš„ç‰›é¡¿æ–¹ç¨‹ã€‚

'vc-md'ï¼šå…è®¸cellæ”¹å˜çš„mdã€‚

pw.xçš„è¾“å…¥è¯´æ˜è§[è¿™é‡Œ](https://www.quantum-espresso.org/Doc/INPUT_PW.html)ã€‚
æ³¨æ„é»˜è®¤çš„å•ä½ï¼Œå…¶ä¸­åŸå­å•ä½åˆ¶ä¸ºï¼ˆä»¥ä¸‹æ•°å€¼è§æºç¨‹åºq-e-qe-6.3/Modules/constants.f90ï¼‰ï¼š

```
1 bohr = 1 a.u. (atomic unit) = 0.52917720859 angstroms.
1 Rydberg (Ry) = 13.60569193 eV
```

pw.xçš„åˆå§‹æ™¶ä½“ç»“æ„åŠæ™¶æ ¼å‚æ•°é€šå¸¸æ˜¯å®éªŒå€¼ã€‚ä½†æ˜¯ï¼Œä¸ºäº†åç»­çš„è®¡ç®—å¯èƒ½éœ€è¦é€šè¿‡åŠ›çš„å¼›è±«ï¼ˆrelaxï¼‰å¾—åˆ°æ™¶æ ¼å‚æ•°çš„ç†è®ºå€¼ï¼ˆå¦‚æœåªè®¡ç®—ä½“ææ–™èƒ½å¸¦ï¼Œè€Œæ‰€å…³å¿ƒçš„é—®é¢˜åªé™äºç”µå­æ€§è´¨è€Œæ— å…³æ™¶æ ¼ï¼Œä½¿ç”¨å®éªŒå€¼ä¹Ÿæ˜¯å¯ä»¥çš„ï¼‰ã€‚è¿™é‡Œçš„CELL_PARAMETERç”¨äº†å¸¸è§çš„å¯¹ç§°å†™æ³•ï¼Œä¸ä¸Šä¸€èŠ‚ä»cifè·å¾—çš„åŸèƒç­‰ä»·ã€‚

ç»“æ„å¼›è±«çš„è¾“å…¥æ–‡ä»¶å¦‚ä¸‹ï¼š

```
&CONTROL
    calculation='vc-relax', disk_io='low', prefix='pwscf',
    pseudo_dir='./', outdir='./tmp', verbosity='low'
    tprnfor=.true., tstress=.true., forc_conv_thr=1.0d-5
/
&SYSTEM
    ibrav= 0,
    celldm(1) = 1.8897261328856432, ! a.u. to Angst
    nat= 2, ntyp= 2,
    occupations = 'smearing', smearing = 'gauss', degauss = 1.0d-9
    ecutwfc= 50, ecutrho = 500,
/
&ELECTRONS
    electron_maxstep = 100
    conv_thr = 1.0d-9
    mixing_mode = 'plain'
    mixing_beta = 0.8d0
    diagonalization = 'david'
/
&IONS
    ion_dynamics='bfgs'
/
&CELL
    press_conv_thr=0.1
/
ATOMIC_SPECIES
  Si 28.08550 Si.UPF
  C  12.01070 C.UPF
CELL_PARAMETERS (alat=  1.88972613)
   2.174000000   2.174000000   0.000000000
   0.000000000   2.174000000   2.174000000
   2.174000000   0.000000000   2.174000000
ATOMIC_POSITIONS (crystal)
Si       0.000000000   0.000000000   0.000000000
C        0.250000000   0.250000000   0.250000000
K_POINTS {automatic}
  8 8 8 0 0 0 
```

èµåŠ¿æ–‡ä»¶ç”±ld1.xç”Ÿæˆï¼Œld1.xçš„è¾“å…¥æ–‡ä»¶æ¥è‡ª[pslibrary1.0](http://www.quantum-espresso.org/pseudopotentials/pslibrary)ã€‚

<a href="../../../../../img/Si.UPF">Si.UPF</a>
<a href="../../../../../img/C.UPF">C.UPF</a>

å°†è¾“å…¥æ–‡ä»¶ä¿å­˜æˆrelax.inpï¼Œå’Œä¸¤ä¸ªèµåŠ¿æ–‡ä»¶æ”¾åœ¨åŒä¸€ç›®å½•ï¼Œè¿è¡Œ```pw.x < relax.inp > relax.out``` å¼€å§‹è®¡ç®—ã€‚ï¼ˆå¹¶è¡Œè®¡ç®—ï¼Œå®‰è£…äº†openmpiåˆ™è¿è¡Œ```mpirun -np 16 < relax.inp > relax.out```ï¼Œå…¶ä¸­ï¼Œ16æ˜¯ä½¿ç”¨çš„æ ¸æ•°ã€‚ï¼‰

åœ¨è¾“å‡ºæ–‡ä»¶ä¸­å¯ä»¥æ‰¾åˆ°å¼›è±«åçš„æ™¶æ ¼ç»“æ„ï¼Œå¯ä»¥çœ‹å‡ºæ™¶æ ¼å¸¸æ•°ç†è®ºå€¼ä¸º4.378Ã…ã€‚ç»“æ„å¼›è±«é€šè¿‡åŠ›çš„è®¡ç®—å¾—åˆ°æ€»èƒ½-ä½å½¢æ›²é¢ä¸Šçš„å±€éƒ¨æå°å€¼ï¼Œä¸ºäº†æ¨¡æ‹Ÿå®é™…ï¼Œéœ€è¦åˆå§‹ç»“æ„ä¸å®é™…æƒ…å†µè¶³å¤Ÿæ¥è¿‘ã€‚


```
Begin final coordinates
     new unit-cell volume =    141.54636 a.u.^3 (    20.97501 Ang^3 )
     density =      0.15834 g/cm^3

CELL_PARAMETERS (alat=  1.88972613)
   2.188890473   2.188890473   0.000000000
   0.000000000   2.188890473   2.188890473
   2.188890473   0.000000000   2.188890473

ATOMIC_POSITIONS (crystal)
Si       0.000000000  -0.000000000   0.000000000
C        0.250000000   0.250000000   0.250000000
End final coordinates
```

relaxè®¡ç®—åŒ…æ‹¬å¤šä¸ªè‡ªæ´½è®¡ç®—ï¼ŒæŸ¥çœ‹è‡ªæ´½è®¡ç®—å¾—åˆ°çš„æ€»èƒ½ç”¨
```bash
grep '!' relax.out
```
è¾“å‡ºä¸ºï¼š
```
!    total energy              =     -22.67776498 Ry
!    total energy              =     -22.67819319 Ry
!    total energy              =     -22.67819977 Ry
!    total energy              =     -22.67819977 Ry
!    total energy              =     -22.67821030 Ry
```
å¯è§ï¼Œè¿™é‡Œrelaxç»å†äº†äº†5ä¸ªè‡ªæ´½è®¡ç®—æ­¥éª¤åè¾¾åˆ°æ”¶æ•›ï¼Œæœ€åä¸€ä¸ªæ˜¯ç»“æ„å¼›è±«è®¡ç®—å¾—åˆ°çš„ä½“ç³»æ€»èƒ½ã€‚æ³¨æ„ï¼Œè‡ªæ´½è®¡ç®—æ€»èƒ½åªå…·æœ‰ç›¸å¯¹æ„ä¹‰ï¼Œä¸åŒèµåŠ¿è®¡ç®—å¾—åˆ°çš„æ€»èƒ½ä¸èƒ½æ¯”è¾ƒï¼Œç”¨ç›¸åŒèµåŠ¿è®¡ç®—çš„æ€»èƒ½å¯ä»¥æ±‚å·®å€¼ã€‚


#### 1.2.1 å æ®æ•°ã€å±•å®½çš„è®¾ç½®
å¯¹äºå¯¼ä½“ï¼Œç”±äºå­˜åœ¨åŠæ»¡çš„èƒ½å¸¦ï¼Œè€Œåªæœ‰å æ®çš„èƒ½çº§å¯¹äºæ€»èƒ½æœ‰è´¡çŒ®ï¼Œè´¹ç±³èƒ½çº§é™„è¿‘çš„èƒ½çº§åœ¨è‡ªæ´½è®¡ç®—æ—¶å¯èƒ½å‡ºç°ç›¸é‚»ä¸¤æ¬¡è‡ªæ´½è¿­ä»£ä¸€æ¬¡å æ®ä¸€æ¬¡ä¸å æ®ï¼Œå¯¼è‡´æ€»èƒ½ï¼Œå°¤å…¶æ˜¯å•ç”µå­èƒ½çº§ä¹‹å’Œéœ‡è¡çš„æƒ…å†µã€‚è®¡ç®—æ€»èƒ½æ—¶ï¼Œé™¤äº†ä½¿ç”¨è¶³å¤Ÿå¯†çš„kç‚¹ç½‘æ ¼ä»¥å¤–ï¼Œè®¾ç½®å æ®æ•°çš„å±•å®½ï¼Œè€ƒè™‘è´¹ç±³èƒ½çº§é™„è¿‘çš„èƒ½çº§éƒ½å¯¹æ€»èƒ½æœ‰ä¸€å®šè´¡çŒ®ï¼Œå¯ä»¥è®©è®¡ç®—æ›´å®¹æ˜“æ”¶æ•›ï¼Œå¹¶ä¸”å¾—åˆ°è¾ƒå‡†ç¡®çš„èƒ½å¸¦å’Œæ€å¯†åº¦ã€‚kç‚¹å’Œå±•å®½çš„è®¾ç½®ï¼Œä¸ä»…å¯¹äºæ€»èƒ½ï¼Œè€Œä¸”å¯¹äºæ‰€æœ‰éœ€è¦åœ¨æ•´ä¸ªå¸ƒé‡Œæ¸ŠåŒºç§¯åˆ†çš„ç‰©ç†é‡çš„è®¡ç®—æ”¶æ•›æœ‰å½±å“ã€‚

å»ºè®®è®¾ç½®```occupation='smearing',smearing='gaussian'```ï¼Œä½¿ç”¨é«˜æ–¯å±•å®½ã€‚å¯¹äºä¸åŒçš„ææ–™è°ƒæ•´degaussçš„å€¼ï¼Œå¯¹äºæœ‰å¸¦éš™çš„ææ–™ï¼Œ```degauss=1d-9```ï¼Œä¹Ÿå°±æ˜¯æ¥è¿‘0å°±å¯ä»¥ï¼Œå¯¹äºæ²¡æœ‰å¸¦éš™çš„å¯¼ä½“ææ–™ï¼Œdegaussä»å°å°è¯•åˆ°å¤§ï¼Œå–å€¼çº¦0.01Ryé‡çº§ï¼Œkç‚¹è¶³å¤Ÿå¤šçš„åŸºç¡€ä¸Šï¼ˆè§1.2.2ï¼‰ï¼Œæµ‹è¯•degaussä¸€è¦æ€»èƒ½å‡ ä¹ä¸å˜ï¼ŒäºŒè¦è¾“å‡ºä¸­çš„â€œsmearing contribution TSâ€è¶³å¤Ÿå°ï¼Œå»ºè®®å°äº$1\times10^{-4}$ Ry/atomã€‚

#### 1.2.2 è‡ªæ´½è®¡ç®—kç‚¹çš„è®¾ç½®
æ€»èƒ½è®¡ç®—éœ€è¦å¯¹ç”µè·ç§¯åˆ†ï¼Œç”±äºQEä¸­çš„Kohn-Shamæ–¹ç¨‹æ˜¯åœ¨kç©ºé—´ä¸­è¿›è¡Œçš„ï¼Œéœ€è¦åœ¨kç©ºé—´å‡åŒ€å–ç‚¹è¿›è¡Œç”µè·çš„ç§¯åˆ†ï¼ŒåŸåˆ™ä¸Šæ›´å¯†çš„ç½‘æ ¼å¾—åˆ°çš„ç”µè·æ›´å‡†ç¡®ï¼Œä½†æ˜¯è€ƒè™‘çš„åˆ°è®¡ç®—é‡ï¼Œå®é™…è®¡ç®—çš„kç‚¹æ˜¯è¾ƒä¸ºæœ‰é™çš„ï¼Œå¯¹äºç»ç¼˜ä½“ï¼Œ$0.5Ã…^{-1}$é—´è·çš„kç‚¹ç½‘æ ¼ä¸€èˆ¬å¯ä»¥å®ç°æ”¶æ•›ï¼Œè®¾ç½®

```
K_POINTS {automatic}
nk1, nk2, nk3, k1, k2, k3
```
å…¶ä¸­ï¼Œå‰ä¸‰ä¸ªæ•°nk1, nk2, nk3æ˜¯å€’æ ¼å­ä¸‰ä¸ªåŸºçŸ¢æ–¹å‘çš„kç‚¹ç½‘æ ¼ï¼Œç”±äºå¯¹ç§°æ€§å¯èƒ½å®é™…è®¡ç®—kç‚¹ä¸ªæ•°æœ‰çº¦åŒ–ï¼Œnkçš„å€¼å¯¹äºè¾ƒé•¿çš„CELLåŸºçŸ¢æ–¹å‘å–å€¼è¾ƒå°ï¼Œå»ºè®®ç»ç¼˜ä½“è®¾ç½®kç‚¹é—´è·åœ¨$0.5Ã…^{-1}$ä»¥ä¸‹ï¼Œå¯¹äºå¯¼ä½“ï¼Œnkçš„å€¼è¾ƒå¤§ï¼Œéœ€è¦åŒæ—¶ç»“åˆdegaussæµ‹è¯•æ”¶æ•›ã€‚åä¸‰ä¸ªæ•°k1, k2, k3æ˜¯è®¾ç½®kç‚¹ç½‘æ ¼æ˜¯å¦å«ç›¸åº”çš„0ç‚¹ã€‚

### 1.3 è‡ªæ´½è®¡ç®—çš„è¾“å…¥æ–‡ä»¶
ç”±äºpw.xçº¦å®šåœ¨åŒä¸€ç›®å½•ä¸‹è¿è¡Œvc-relaxå’Œrelaxè®¡ç®—åçš„scfæˆ–bandsè®¡ç®—ä¼šè¯»å–å¼›è±«åçš„ç»“æ„ã€‚æ‰€ä»¥ï¼Œå°†calculation='vc-relax'æ”¹æˆcalculation='scf'ï¼Œå…¶ä»–éƒ¨åˆ†ä¸ä¸Šä¸€æ­¥è¾“å…¥æ–‡ä»¶ç›¸åŒã€‚å¦å¤–ï¼Œvc-relaxå’Œrelaxè®¡ç®—æœ€åä¸€æ­¥åŒ…å«äº†æœ€ç»ˆç»“æ„çš„scfè®¡ç®—ï¼Œæ‰€ä»¥è¿™é‡Œçœå»è¿™ä¸€æ­¥éª¤ã€‚

### 1.4 èƒ½å¸¦è®¡ç®—çš„è¾“å…¥æ–‡ä»¶
èƒ½å¸¦è®¡ç®—éœ€è¦è®¾ç½®kç‚¹è·¯å¾„ï¼Œæˆ‘ä»¬å‚è€ƒæ–‡çŒ®[4]ç»™å‡ºçš„ç‰¹æ®Škç‚¹åæ ‡ï¼Œé€‰å–äº†è·¯å¾„X-Î“-Lã€‚åœ¨relaxè®¡ç®—çš„åŒä¸€ç›®å½•ä¸‹ï¼Œå°†èƒ½å¸¦è®¡ç®—è¾“å…¥æ–‡ä»¶å¦‚ä¸‹ä¿å­˜ä¸ºnscf_b.inpï¼Œè¿è¡Œ```pw.x < nscf_b.inp > nscf_b.out```ã€‚

```
&CONTROL
    calculation='bands', disk_io='low', prefix='pwscf',
    pseudo_dir='./', outdir='./tmp', verbosity='low'
    tprnfor=.true., tstress=.true., forc_conv_thr=1.0d-5
/
&SYSTEM
    ibrav= 0,
    celldm(1) = 1.8897261328856432, ! a.u. to Angst
    nat= 2, ntyp= 2,
    occupations = 'smearing', smearing = 'gauss', degauss = 1.0d-9
    ecutwfc= 50, ecutrho = 500,
/
&ELECTRONS
    electron_maxstep = 100
    conv_thr = 1.0d-9
    mixing_mode = 'plain'
    mixing_beta = 0.8d0
    diagonalization = 'david'
/
&IONS
    ion_dynamics='bfgs'
/
&CELL
    press_conv_thr=0.1
/
ATOMIC_SPECIES
  Si 1.0 Si.UPF
  C  1.0 C.UPF
CELL_PARAMETERS (alat=  1.88972613)
   2.174000000   2.174000000   0.000000000
   0.000000000   2.174000000   2.174000000
   2.174000000   0.000000000   2.174000000
ATOMIC_POSITIONS (crystal)
Si       0.000000000   0.000000000   0.000000000
C        0.250000000   0.250000000   0.250000000
K_POINTS {crystal_b}
3
0.5 0.0 0.5 30
0.0 0.0 0.0 30
0.5 0.5 0.5 1
```

ä½¿ç”¨QEçš„åå¤„ç†ç¨‹åºbands.xå°†èƒ½å¸¦ç»“æœè½¬ä¸ºæ˜“äºç”»å›¾çš„æ ¼å¼ï¼Œå°†ä»¥ä¸‹ä»£ç ä¿å­˜ä¸ºbds.inpï¼Œè¿è¡Œbands.x < bands.inp > bands.out
```
&bands
prefix='pwscf',
outdir='tmp'
filband='bd.dat'
lp=.true.
/
```
è¿™ä¸€ä¸ªæ­¥éª¤æ˜¯è¯»å–pw.xçš„è¾“å‡ºï¼Œè¿è¡ŒæˆåŠŸåï¼Œä¼šç”Ÿæˆfilbandæ‰€å‘½åçš„æ–‡ä»¶ï¼Œè¿™é‡Œæ˜¯bd.datï¼Œbd.datçš„å†…å®¹è§[è¿™é‡Œ](https://github.com/yyyu200/DFTbook/blob/master/_data/HandsOn/bd.dat)ï¼Œæ˜¯æ¯ä¸ªkç‚¹çš„èƒ½çº§å€¼ï¼Œæ³¨æ„è¿™é‡Œçš„èƒ½çº§æ•°å€¼åªæœ‰ç›¸å¯¹çš„æ„ä¹‰ï¼Œèƒ½é‡çš„å‚è€ƒç‚¹æ˜¯ä¸ç¡®å®šçš„ã€‚é€šå¸¸ï¼Œç”»èƒ½å¸¦å›¾æ—¶ï¼Œç»ç¼˜ä½“ç”¨ä»·å¸¦é¡¶ä½œä¸ºèƒ½é‡é›¶ç‚¹ï¼Œå¯¼ä½“ç”¨è´¹ç±³èƒ½çº§ä½œä¸ºèƒ½é‡é›¶ç‚¹ã€‚æ¥ä¸‹æ¥å¯ä»¥ç”¨QEè‡ªå¸¦çš„plotband.xç”»èƒ½å¸¦å›¾ï¼Œä½†æ˜¯ç”»å›¾çš„è‡ªå®šä¹‰æ•ˆæœä¸å¤Ÿï¼Œè¿™é‡Œä¸å†ä»‹ç»ï¼Œè¿™é‡Œä¸ºäº†ç”¨bd.datç”»èƒ½å¸¦ï¼Œä½¿ç”¨pythonè¿è¡Œä»¥ä¸‹ä»£ç ï¼š
```python
# -*- coding: utf-8 -*-
"""
@author: yyyu200@163.com
"""

import numpy as np

feig=open('bd.dat')
ymin=-20
ymax=20
nband=4 # this is the valence band number, for insulators only
dline=30 # vertical line intervals

l=feig.readline()
nbnd=int(l.split(',')[0].split('=')[1])
nks=int(l.split(',')[1].split('=')[1].split('/')[0])

eig=np.zeros((nks,nbnd),dtype=float)
for i in range(nks):
    l=feig.readline()
    count=0
    for j in range(nbnd//10+1):
        l=feig.readline()
        for k in range(len(l.split())):
            eig[i][count]=l.split()[k]
            count=count+1
            
feig.close()

import matplotlib as mpl
mpl.use('Agg')
import matplotlib.pyplot as plt

p1=plt.subplot(1, 1, 1)

F=plt.gcf()
F.set_size_inches([3,5])
lw=1.2 # line width

plt.xlim([0,nks-1]) # 201 points
plt.ylim([ymin,ymax])
#plt.xlabel(r'$k (\AA^{-1})$',fontsize=16)
plt.ylabel(r' E (eV) ',fontsize=16)

eig_vbm=max(eig[:,nband-1])
eig_cbm=min(eig[:,nband])
Gap=eig_cbm-eig_vbm

plt.title("Band gap="+str(Gap)[0:8]+" eV")  # for insulators only
for i in range(nbnd):
    line1=plt.plot( eig[:,i]-eig_vbm,color='r',linewidth=lw ) 

vline=dline
while vline<nks-1:
    plt.axvline(x=vline, ymin=ymin, ymax=ymax,linewidth=lw,color='black')
    vline=vline+dline

plt.xticks( (0,30,60), ('X', r'${\Gamma}$', 'L') )

plt.savefig('pwband.png',dpi=500)

```

è®¡ç®—èƒ½å¸¦ç»“æœä¸æ–‡çŒ®æ¯”è¾ƒå¦‚ä¸‹[[5]](http://www.ioffe.ru/SVA/NSM/Semicond/SiC/bandstr.html)ã€‚X-Î“å¸¦éš™å®éªŒå€¼ä¸º2.416eVï¼Œè®¡ç®—å€¼ä¸º1.378eVï¼Œç”±äºäº¤æ¢å…³è”è¿‘ä¼¼çš„åŸå› ï¼ŒPBEè®¡ç®—å‡ºçš„å¸¦éš™å­˜åœ¨åå°çš„é—®é¢˜ã€‚

<p align="left">
    <img src="../../../../../img/pwband.png" width="200"/>
    <img src="../../../../../img/mband_3C_SiC.gif" width="300"/>
</p>

## 2. è®¡ç®—é‡‘å±é“œçš„åŠŸå‡½æ•°
å¯¼ä½“çš„åŠŸå‡½æ•°æ˜¯æŒ‡å¯¼ä½“çš„è´¹ç±³èƒ½çº§åˆ°çœŸç©ºèƒ½çº§çš„å·®å€¼ï¼Œå¯¹äºç»ç¼˜ä½“æ¥è¯´ï¼Œä¸€èˆ¬ç”¨ç±»ä¼¼çš„æ¦‚å¿µï¼Œå¦‚ç”µç¦»åŠ¿ï¼ˆionic potentialï¼‰å’Œäº²å’Œèƒ½ï¼ˆelectron affinityï¼‰æ¥è¡¨ç¤ºä»·å¸¦é¡¶å’Œå¯¼å¸¦åº•ä¸çœŸç©ºèƒ½çº§çš„å·®å€¼ã€‚pw.xé€šè¿‡scfè®¡ç®—å¾—åˆ°è‡ªæ´½ç”µè·å¯†åº¦ï¼Œè¿›è€Œå¾—åˆ°CELLå†…å„ä¸ªç‚¹çš„åŠ¿èƒ½ï¼ŒåŒæ—¶å¾—åˆ°ä½“ç³»çš„è´¹ç±³èƒ½çº§ã€‚åœ¨pw.xä¸­ï¼Œç”±äºå¹³é¢æ³¢ç¨‹åºçš„å‘¨æœŸæ€§è¾¹ç•Œæ¡ä»¶ï¼Œèƒ½çº§çš„å‚è€ƒç‚¹æ˜¯ä¸ç¡®å®šçš„ï¼Œæ‰€ä»¥åœ¨å—æï¼ˆbulkï¼‰çš„è®¡ç®—ä¸­æ— æ³•å¾—åˆ°çœŸç©ºèƒ½çº§ã€‚ä¸ºäº†åŒæ—¶å¾—åˆ°è´¹ç±³èƒ½çº§å’ŒçœŸç©ºèƒ½çº§ï¼Œéœ€è¦å»ºç«‹å¹³æ¿ï¼ˆslabï¼‰æ¨¡å‹ï¼Œåœ¨CELLä¸­ç•™ç©ºï¼Œç•™ç©ºçš„åŒºåŸŸå³æ˜¯çœŸç©ºï¼Œç”µè·å¯†åº¦åŸºæœ¬ä¸º0ï¼Œæ‰€ä»¥åŠ¿èƒ½æ˜¯å¸¸æ•°ï¼Œå³çœŸç©ºèƒ½çº§ã€‚åœ¨slabè®¡ç®—ä¸­è´¹ç±³èƒ½çº§ï¼ˆç»ç¼˜ä½“çš„VBMï¼‰ç”±äºè¡¨é¢æ€çš„å­˜åœ¨è€Œä¸å‡†ç¡®ï¼Œè€Œslabå†…çš„å¹³å‡åŠ¿èƒ½å’ŒçœŸç©ºå¹³å‡åŠ¿èƒ½æ˜¯å‡†ç¡®çš„ï¼›åœ¨bulkè®¡ç®—ä¸­ï¼Œè´¹ç±³èƒ½çº§å’Œå¹³å‡åŠ¿èƒ½çš„å·®å€¼æ˜¯å‡†ç¡®çš„ã€‚è®¤ä¸ºslabå†…å¹³å‡åŠ¿èƒ½å’Œbulkå¹³å‡åŠ¿èƒ½æ˜¯å¯¹åº”çš„ï¼Œåˆ™å¯ä»¥å¾—åˆ°çœŸç©ºèƒ½çº§å’Œè´¹ç±³èƒ½çº§çš„å·®å€¼ï¼Œå³åŠŸå‡½æ•°ï¼Œå‚è€ƒæ–‡çŒ®[6]ã€‚

åŠŸå‡½æ•°ä¸æ™¶å‘ã€é‡æ„ã€å¸é™„ç­‰å¯†åˆ‡ç›¸å…³ï¼Œè¿™é‡Œè€ƒè™‘é‡‘å±Cuæœªé‡æ„çš„ï¼ˆ110ï¼‰è¡¨é¢ï¼Œå¯¹äºç»ç¼˜ä½“çš„ç”µç¦»åŠ¿å¯ä»¥é€šè¿‡ç±»ä¼¼æ–¹æ³•å¾—åˆ°ã€‚

### 2.1 è®¡ç®—é“œçš„æ™¶æ ¼å¸¸æ•°ã€èƒ½å¸¦å’Œæ€å¯†åº¦
ç”¨é¦–å…ˆè®¡ç®—é¢å¿ƒç«‹æ–¹é“œçš„åŸèƒï¼Œç”¨```calculation='vc-relax'```ä¼˜åŒ–æ™¶æ ¼å¸¸æ•°ã€‚å®éªŒæ™¶æ ¼å¸¸æ•°ä¸º3.61Ã…ã€‚
```
&CONTROL
    calculation='vc-relax', disk_io='low', prefix='pwscf',
    pseudo_dir='./', outdir='./tmp', verbosity='low'
    tprnfor=.true., tstress=.true., forc_conv_thr=1.0d-5
/
&SYSTEM
    ibrav= 0,
    celldm(1) = 1.8897261328856432, ! a.u. to Angst
    nat= 1, ntyp= 1,
    occupations = 'smearing', smearing = 'gauss', degauss = 1.0d-2
    ecutwfc= 50, ecutrho = 500,
/
&ELECTRONS
    electron_maxstep = 100
    conv_thr = 1.0d-9
    mixing_mode = 'plain'
    mixing_beta = 0.8d0
    diagonalization = 'david'
/
&IONS
    ion_dynamics='bfgs'
/
&CELL
    press_conv_thr=0.1
/
ATOMIC_SPECIES
  Cu 63.546 Cu.UPF
CELL_PARAMETERS (alat=  1.88972613)
  1.8050000   1.8050000   0.0000000 
  1.8050000   0.0000000   1.8050000 
  0.0000000   1.8050000   1.8050000 
ATOMIC_POSITIONS (crystal)
Cu  0.000000000   0.000000000   0.000000000
K_POINTS {automatic}
  13 13 13 0 0 0 
```

ç”¨PBEäº¤æ¢å…³è”è¿‘ä¼¼è®¡ç®—å¾—åˆ°æ™¶æ ¼å¸¸æ•°ç†è®ºå€¼æ˜¯3.6232Ã…ã€‚è¿è¡Œ```grep 'smearing contrib.' vc.out ```ï¼Œ
```
     smearing contrib. (-TS)   =      -0.00021395 Ry
     smearing contrib. (-TS)   =      -0.00021409 Ry
     smearing contrib. (-TS)   =      -0.00021414 Ry
     smearing contrib. (-TS)   =      -0.00021413 Ry
     smearing contrib. (-TS)   =      -0.00021411 Ry
```
ç»“æœåœ¨å¯æ¥å—èŒƒå›´ã€‚

è¿è¡Œ```grep Fermi vc.out |tail -1```ï¼Œå¾—åˆ°è´¹ç±³èƒ½çº§ã€‚
```
     the Fermi energy is    12.6479 ev
```

è®¡ç®—æ€å¯†åº¦ï¼Œnscf.inpè¾“å…¥å¦‚ä¸‹ï¼Œä½¿ç”¨äº†$53^{3}=148877$ä¸ªkç‚¹çš„ç½‘æ ¼ï¼Œä»¥å¾—åˆ°è¾ƒä¸ºå¹³æ»‘çš„DOSæ›²çº¿ã€‚
```
&CONTROL
    calculation='nscf', disk_io='low', prefix='pwscf',
    pseudo_dir='./', outdir='./tmp', verbosity='low'
    tprnfor=.true., tstress=.true., forc_conv_thr=1.0d-5
/
&SYSTEM
    ibrav= 0,
    celldm(1) = 1.8897261328856432, ! a.u. to Angst
    nat= 1, ntyp= 1,
    occupations = 'smearing', smearing = 'mp', degauss = 2.5d-2
    ecutwfc= 50, ecutrho = 500,
/
&ELECTRONS
    electron_maxstep = 100
    conv_thr = 1.0d-9
    mixing_mode = 'plain'
    mixing_beta = 0.8d0
    diagonalization = 'david'
/
&IONS
    ion_dynamics='bfgs'
/
&CELL
    press_conv_thr=0.1
/
ATOMIC_SPECIES
  Cu 63.546 Cu.UPF
CELL_PARAMETERS (alat=  1.88972613)
  1.8050000   1.8050000   0.0000000
  1.8050000   0.0000000   1.8050000
  0.0000000   1.8050000   1.8050000
ATOMIC_POSITIONS (crystal)
Cu  0.000000000   0.000000000   0.000000000
K_POINTS {automatic}
  53 53 53 0 0 0
```
å°†ä»¥ä¸‹è¾“å…¥å‚æ•°ä¿å­˜ä¸ºdos.inpï¼Œè¿è¡Œ```dos.x < dos.inp > dos.out```

```
&dos 
 prefix='pwscf'
 outdir='./tmp'
 ngauss=1
 degauss=1.5d-2
 DeltaE=1.0d-2
 fildos='cu.dos'
/ 
```

å°†nscfè®¡ç®—è¾“å…¥ä¸­K_POINTSæ”¹ä¸ºå¦‚ä¸‹ï¼Œè®¾ç½®```calculation='bands'```ï¼Œè®¡ç®—èƒ½å¸¦ã€‚
```
K_POINTS {crystal_b}
6
0.5 0.5 0.5 50
0.0 0.0 0.0 50
0.5 0.0 0.5 20
0.625 0.25 0.625 0
0.375 0.375 0.75 50
0.0 0.0 0.0 1
```

è®¡ç®—å¾—åˆ°çš„èƒ½å¸¦å’Œæ€å¯†åº¦å¦‚ä¸‹å›¾ï¼Œç”»å›¾æ—¶è¦åˆ æ‰ç¬¬120ä¸ªkç‚¹ï¼ˆUç‚¹ï¼‰çš„èƒ½çº§ã€‚
<p align="left">
    <img src="../../../../../img/pwbanddos.png" width="1000"/>
</p>

### 2.2 å»ºç«‹slabæ¨¡å‹å¹¶åšç»“æ„é©°è±«
å»ºç«‹slabæ¨¡å‹çš„ä¸€èˆ¬æ–¹æ³•è§[è¿™é‡Œ](../../07/TransCell/#å¹³æ¿slabæ¨¡å‹çš„å»ºç«‹)ã€‚å»ºç«‹slabæ¨¡å‹ä½¿ç”¨å‰ä¸€èŠ‚å¾—åˆ°çš„ç†è®ºæ™¶æ ¼å¸¸æ•°ï¼Œå…ˆå¯¹åŸèƒåšå˜æ¢$$P_{1}$$å¾—åˆ°æ™¶èƒï¼Œå†åšå˜æ¢$$P_{2}$$å¾—åˆ°(110)æ–¹å‘é•¿åº¦ä¸º19ä¸ªåŸå­çš„è¶…èƒï¼Œæœ€ååŠ ä¸Š20Ã…çš„çœŸç©ºï¼Œå¾—åˆ°slabæ¨¡å‹ï¼Œå…¶ä¸­

$$
P_{1}=\quad
\begin{pmatrix}
-1 & 1 & 1 \\
 1 &-1 & 1 \\
 1 & 1 &-1 \\
\end{pmatrix}
Q_{1}=\quad
\begin{pmatrix}
0 & 1 \over 2 & 1 \over 2 \\
1 \over 2 & 0 & 1 \over 2 \\
1 \over 2 & 1 \over 2 & 0 \\
\end{pmatrix}
\quad 
P_{2}=\quad
\begin{pmatrix}
1 & 0 & 0 \\
0 & 1 \over 2  & 5 \\
0 & - {1\over 2} & 5 \\
\end{pmatrix}
\quad
Q_{2}=\quad
\begin{pmatrix}
1 & 0 & 0 \\
0 & 1 & -1 \\
0 & 0.1 & 0.1 \\
\end{pmatrix}
\quad
$$

åœ¨VESTAä¸­è¾“å…¥P2å˜æ¢çŸ©é˜µï¼Œå¹¶ä»¥POSCARæ ¼å¼è¾“å‡ºå¾—åˆ°ï¼š
```
New structure
1.0
        3.6231999397         0.0000000000         0.0000000000
        0.0000000000         2.5619893074         0.0000000000
        0.0000000000         0.0000000000        25.6198921204
   Cu
   20
Direct
     0.000000000         0.000000000         0.000000000
     0.000000000         0.000000000         0.100000001
     0.500000000         0.500000000         0.050000001
     0.000000000         0.000000000         0.899999976
     0.500000000         0.500000000         0.449999988
     0.500000000         0.500000000         0.550000012
     0.000000000         0.000000000         0.200000003
     0.500000000         0.500000000         0.649999976
     0.500000000         0.500000000         0.949999988
     0.500000000         0.500000000         0.150000006
     0.000000000         0.000000000         0.500000000
     0.000000000         0.000000000         0.600000024
     0.000000000         0.000000000         0.800000012
     0.000000000         0.000000000         0.300000012
     0.500000000         0.500000000         0.250000000
     0.500000000         0.500000000         0.850000024
     0.000000000         0.000000000         0.699999988
     0.000000000         0.000000000         0.400000006
     0.500000000         0.500000000         0.349999994
     0.500000000         0.500000000         0.750000000
```
<p align="left">
    <img src="../../../../../img/cu110slab.png" width="1000"/>
</p>

åŠ å…¥çœŸç©ºæ—¶ï¼ŒCELLçš„é¢å†…åŸºçŸ¢ä¸å˜ï¼Œåˆ æ‰æœ€é¡¶ç«¯çš„ä¸€ä¸ªåŸå­ï¼Œä»¥ä¿æŒslabçš„ä¸¤ä¸ªè¡¨é¢çš„å¯¹ç§°æ€§ï¼Œä¸å¼•å…¥ä¸¤ä¸ªè¡¨é¢ä¸å¯¹ç§°ä¼šå½¢æˆçš„å¶æåœºï¼ˆå¯¹äºCuçš„110é¢è¿™ä¸ªä¾‹å­ï¼Œç”±äºå¯¹zæ–¹å‘åšé•œé¢åŠ å¹³ç§»å¯ä»¥å¤åŸï¼Œä¸åˆ é™¤è¿™ä¸ªåŸå­ä¸¤ä¸ªè¡¨é¢ä¹Ÿæ˜¯ç­‰åŠ¿èƒ½çš„ï¼‰ï¼Œzæ–¹å‘å¢åŠ 20Ã…ï¼ŒåŸå­åˆ†æ•°åæ ‡éšä¹‹å˜æ¢ã€‚å¾—åˆ°è¾“å…¥æ–‡ä»¶å¦‚ä¸‹ï¼Œè¿™é‡Œçš„ç»“æ„é©°è±«åº”è¯¥ç”¨```calculation='relax'```è¿›è¡Œã€‚åœ¨æ—©æœŸçš„ç ”ç©¶ä¸­ï¼Œå¸¸å›ºå®šslabå†…éƒ¨åŸå­ï¼Œåªå…è®¸æœ€æ¥è¿‘è¡¨é¢çš„1ï½2å±‚åŸå­é©°è±«ã€‚ç°åœ¨å¸¸å›ºå®šä¸­é—´ä¸€ä¸ªåŸå­ï¼Œç­‰æ•ˆäºæ‰€æœ‰åŸå­å…è®¸é©°è±«ï¼Œå¯ä»¥é¿å…slabçš„æ•´ä½“æ¼‚ç§»ã€‚

```
&CONTROL
    calculation='relax', disk_io='low', prefix='pwscf',
    pseudo_dir='./', outdir='./tmp', verbosity='low'
    tprnfor=.true., tstress=.true., forc_conv_thr=1.0d-4
/
&SYSTEM
    ibrav= 0,
    celldm(1) = 1.8897261328856432, ! a.u. to Angst
    nat= 19, ntyp= 1,
    occupations = 'smearing', smearing = 'gauss', degauss = 1.0d-2
    ecutwfc= 50, ecutrho = 500,
/
&ELECTRONS
    electron_maxstep = 100
    conv_thr = 1.0d-9
    mixing_mode = 'plain'
    mixing_beta = 0.8d0
    diagonalization = 'david'
/
&IONS
    ion_dynamics='bfgs'
/
&CELL
    press_conv_thr=0.1
/
ATOMIC_SPECIES
  Cu 63.546 Cu.UPF
CELL_PARAMETERS (alat=  1.88972613)
  3.6231999397  0.0000000000   0.0000000000
  0.0000000000  2.5619893074   0.0000000000
  0.0000000000  0.0000000000  43.0579029084
K_POINTS {automatic}
  8 8 1 0 0 0 
ATOMIC_POSITIONS (crystal)
Cu  0.000000000    0.000000000    0.232245403
Cu  0.000000000    0.000000000    0.291746425
Cu  0.500000000    0.500000000    0.261995914
Cu  0.000000000    0.000000000    0.767754583
Cu  0.500000000    0.500000000    0.499999993 0 0 0
Cu  0.500000000    0.500000000    0.559501029
Cu  0.000000000    0.000000000    0.351247448
Cu  0.500000000    0.500000000    0.619002029
Cu  0.500000000    0.500000000    0.321496939
Cu  0.000000000    0.000000000    0.529750511
Cu  0.000000000    0.000000000    0.589251547
Cu  0.000000000    0.000000000    0.708253583
Cu  0.000000000    0.000000000    0.410748475
Cu  0.500000000    0.500000000    0.380997957
Cu  0.500000000    0.500000000    0.738004101
Cu  0.000000000    0.000000000    0.648752547
Cu  0.000000000    0.000000000    0.470249493
Cu  0.500000000    0.500000000    0.440498975
Cu  0.500000000    0.500000000    0.678503065
```

### 2.3 è·å–é™ç”µåŠ¿å¹¶å¾—åˆ°åŠŸå‡½æ•°
ç”¨pp.xå¾—åˆ°é™ç”µåŠ¿ï¼Œå¦‚ä¸‹æ–‡ä»¶ä¿å­˜ä¸ºpp.inpï¼Œè¿è¡Œ```pp.x < pp.inp > pp.out```ï¼Œ

```
&INPUTPP
   outdir='./tmp'
   plot_num=11
   filplot='pp11.dat'
/
```
å¾—åˆ°è¾“å‡ºåŠ¿èƒ½æ–‡ä»¶pp11.datï¼Œå…¶ä¸­æ–‡ä»¶çš„ç¬¬ä¸‰è¡Œæœ‰è¯¯ï¼Œ
```
     0        6.84685561      0.70710680     11.88394337      0.00000000      0.00000000      0.00000000
```
æ”¹æˆ

```
     0        1.88972613      0.00000000      0.00000000      0.00000000      0.00000000      0.00000000
```
åˆ†åˆ«æ˜¯ibravå’Œcelldm(6)çš„å€¼ã€‚

ç”¨average.xå¯¹é¢å†…åŠ¿èƒ½å–å¹³å‡ï¼Œå¹¶å¯¹å‚ç›´è¡¨é¢æ–¹å‘åŠ¿èƒ½å–ç§»åŠ¨å¹³å‡å€¼ï¼Œaverage.xè¾“å…¥è¯´æ˜è§[è¿™é‡Œ](https://github.com/QEF/q-e/blob/master/PP/src/average.f90)ï¼Œè¾“å…¥æ–‡ä»¶average.inpå¦‚ä¸‹ï¼Œè¿è¡Œ```average.x< average.inp >average.out```ï¼š

```
1
pp11.dat
1
1000
3
4.8681
```

å…¶ä¸­ï¼Œæœ€åä¸€è¡Œ4.8681æ˜¯ç§»åŠ¨å¹³å‡çš„çª—å£é•¿åº¦,è®¾ç½®ä¸ºé©°è±«åslabä¸­é—´éƒ¨åˆ†çš„å‘¨æœŸå•å…ƒé•¿åº¦ï¼Œå•ä½æ˜¯Bohrã€‚è¾“å‡ºavg.datè§[è¿™é‡Œ](../../../../../img/avg.dat)ï¼ŒåŒ…æ‹¬ä¸‰åˆ—ï¼Œç¬¬ä¸€åˆ—æ˜¯zæ–¹å‘æ ¼ç‚¹ï¼Œç¬¬äºŒåˆ—æ˜¯åŠ¿èƒ½åœ¨xyé¢å†…çš„å¹³å‡ï¼Œç¬¬ä¸‰åˆ—æ˜¯zæ–¹å‘ç§»åŠ¨å¹³å‡ã€‚é€šè¿‡è¿›ä¸€æ­¥æ‹Ÿåˆï¼Œå¾—åˆ°slabä¸­é—´åŠ¿èƒ½ä¸º-0.007Ryï¼ŒçœŸç©ºåŠ¿èƒ½ä¸º0.7044Ryã€‚å¯¹äºåŸèƒçš„å¹³å‡é™ç”µåŠ¿èƒ½ï¼Œå¯ä»¥å¯¹åŠ¿èƒ½ç›´æ¥æ±‚å¹³å‡å€¼ï¼Œå¾—åˆ°åŸèƒçš„å¹³å‡åŠ¿èƒ½æ˜¯0.52914Ryï¼Œç”±å‰é¢è®¡ç®—å¾—åˆ°åŸèƒè´¹ç±³èƒ½çº§12.6479eV=0.9296Ryã€‚

slabä¸­è´¹ç±³èƒ½çº§æ˜¯5.2153eVï¼Œä¸åŠ åŸèƒä¿®æ­£çš„åŠŸå‡½æ•°æ˜¯4.369eVã€‚

è€ŒåŠ äº†åŸèƒä¿®æ­£çš„åŠŸå‡½æ•°ä¸ºï¼š

$$0.7044-0.9296+[0.52914-(-0.007)]=0.311Ry=4.321eV$$.

åŠ¿èƒ½ä½œå›¾å¦‚ä¸‹ï¼Œçº¢è‰²çº¿æ˜¯xyé¢å†…å¹³å‡åŠ¿èƒ½ï¼Œè“è‰²çº¿æ˜¯zæ–¹å‘ç§»åŠ¨å¹³å‡ï¼Œç»¿è‰²çº¿æ˜¯slabå†…éƒ¨å¹³å‡åŠ¿èƒ½ç¤ºæ„ã€‚

<p align="left">
    <img src="../../../../../img/cu_110avg.png" width="1000"/>
</p>

## 3. è®¡ç®—æ°®åŒ–ç¡¼çš„å…‰å­¦æ€§è´¨

è®¡ç®—é—ªé”ŒçŸ¿ç»“æ„ç«‹æ–¹æ°®åŒ–ç¡¼çš„ä»‹ç”µå‡½æ•°ã€‚

### 3.1 ç”¨epsilon.xè®¡ç®—å…‰å­¦æ€§è´¨
epsilon.xè®¡ç®—èƒ½çº§é—´å¶æè·ƒè¿å¾—åˆ°ä»‹ç”µå¸¸æ•°ï¼Œæ ¹æ®ä»¥ä¸‹[å…¬å¼](https://en.wikipedia.org/wiki/Fermi%27s_golden_rule)å¾—åˆ°ä»‹ç”µå¸¸æ•°è™šéƒ¨[7]ï¼š

$\epsilon_2 (\omega)= \frac{4 \pi ^2} {m^2\omega^2} \sum_{V,C} {\int_{BZ} {d^3 k  \frac {2}{(2\pi)^{3}}  \lvert eM_{CV}(K) \rvert ^2 \cdot \delta[E_{C}(k)-E_{V}(k)-h\omega]}}$

è€Œä»‹ç”µå¸¸æ•°å®éƒ¨å¯ä»¥ç”±è™šéƒ¨é€šè¿‡Kramers-Kronigå…³ç³»å˜æ¢å¾—åˆ°ã€‚é€šè¿‡èƒ½å¸¦ç»“æ„ï¼Œå¯ä»¥è®¡ç®—å¾—åˆ°å…¨éƒ¨çš„å…‰å­¦å¸¸æ•°ã€‚

epsilon.xè®¡ç®—ç›®å‰ä»…æ”¯æŒæ¨¡å®ˆæ’èµåŠ¿ã€‚é¦–å…ˆä¼˜åŒ–æ™¶æ ¼å¸¸æ•°ï¼Œè¿è¡Œ```pw.x < vc.inp > vc.out```ï¼Œvc.inpå¦‚ä¸‹ï¼š
```
&CONTROL
    calculation='vc-relax', disk_io='low', prefix='pwscf',
    pseudo_dir='./', outdir='./tmp', verbosity='high'
    tprnfor=.true., tstress=.true., forc_conv_thr=1.0d-5
/
&SYSTEM
    ibrav= 0,
    celldm(1) = 1.8897261328856432, ! a.u. to Angst
    nat= 2, ntyp= 2,
    occupations = 'fixed'
    ecutwfc= 80, ecutrho = 320,
/
&ELECTRONS
    electron_maxstep = 100
    conv_thr = 1.0d-9
    mixing_mode = 'plain'
    mixing_beta = 0.8d0
    diagonalization = 'david'
/
&IONS
    ion_dynamics='bfgs'
/
&CELL
    press_conv_thr=0.1
/
ATOMIC_SPECIES
  B  10.811   B_ONCV_PBE-1.0.upf  
  N  14.00674 N.oncvpsp.upf
CELL_PARAMETERS (alat=  1.88972613)
   1.807500000   1.807500000  -0.000000000
   0.000000000   1.807500000   1.807500000
   1.807500000  -0.000000000   1.807500000
ATOMIC_POSITIONS (crystal)
B        0.000000000   0.000000000   0.000000000
N        0.250000000   0.250000000   0.250000000
K_POINTS {automatic}
  13 13 13 1 1 1

```
èµåŠ¿æ–‡ä»¶è§
[B_ONCV_PBE-1.0.upf](../../../../../img/B_ONCV_PBE-1.0.upf)
[N.oncvpsp.upf](../../../../../img/N.oncvpsp.upf)ã€‚

å¾—åˆ°æ™¶æ ¼å¸¸æ•°PBEè®¡ç®—å€¼3.6215Ã…ã€‚å…‰å­¦æ€§è´¨éœ€è¦è¾ƒå¯†çš„kç‚¹ï¼Œå¹¶ä¸”éœ€è¦å…³æ‰å¯¹ç§°æ€§ï¼Œè®¾ç½®```nosym=.true,noinv=.true```ï¼Œè®¡ç®—çš„å¸¦ä¸ªæ•°nbndè¦å¤§ä¸€äº›ï¼Œåšä¸€æ¬¡nscfè®¡ç®—ï¼š
```
&CONTROL
    calculation='nscf', disk_io='low', prefix='pwscf',
    pseudo_dir='./', outdir='./tmp', verbosity='high'
    tprnfor=.true., tstress=.true., forc_conv_thr=1.0d-5
/
&SYSTEM
    ibrav= 0,
    celldm(1) = 1.8897261328856432, ! a.u. to Angst
    nat= 2, ntyp= 2,
    occupations = 'smearing', smearing='gauss', degauss=1d-9,
    ecutwfc= 80, ecutrho = 320,
    nbnd=30
    nosym=.true,
    noinv=.true,
/
&ELECTRONS
    electron_maxstep = 100
    conv_thr = 1.0d-9
    mixing_mode = 'plain'
    mixing_beta = 0.8d0
    diagonalization = 'david'
/
&IONS
    ion_dynamics='bfgs'
/
&CELL
    press_conv_thr=0.1
/
ATOMIC_SPECIES
  B  10.811   B_ONCV_PBE-1.0.upf  
  N  14.00674 N.oncvpsp.upf
CELL_PARAMETERS (alat=  1.88972613)
   1.810733563   1.810733563   0.000000000
  -0.000000000   1.810733563   1.810733563
   1.810733563  -0.000000000   1.810733563
ATOMIC_POSITIONS (crystal)
B        0.000000000   0.000000000   0.000000000
N        0.250000000   0.250000000   0.250000000
K_POINTS {automatic}
  13 13 13 0 0 0
```
ä»¥ä¸‹å†…å®¹ä¿å­˜ä¸ºepsilon.inpï¼Œè¿è¡Œepsilon.x < epsilon.inp > epsilon.outï¼š
```
&inputpp
  outdir='./tmp'
  calculation='eps'
/
&energy_grid
  smeartype='gauss'
  intersmear=0.50
  intrasmear=0.0
  wmin=0.0
  wmax=60.0
  nbndmin=1
  nbndmax=0
  nw=2000
  shift=0.0
/
```
è¾“å‡º4ä¸ªæ–‡ä»¶eels_pwscf.dat,epsi_pwscf.dat,epsr_pwscf.dat,ieps_pwscf.datï¼Œåˆ†åˆ«æ˜¯eelsè°±ï¼ˆç”µå­èƒ½é‡æŸå¤±è°±ï¼‰ï¼Œä»‹ç”µå‡½æ•°çš„è™šéƒ¨ã€å®éƒ¨ï¼Œè™šè½´ä¸Šçš„ä»‹ç”µå‡½æ•°ã€‚å‰ä¸‰ä¸ªç»“æœè§ä¸‹å›¾ï¼Œä¸å®éªŒåŠå…¶ä»–è®¡ç®—ç»“æœæ¯”è¾ƒè§[8]ã€‚

<p align="left">
    <img src="../../../../../img/bn_epsilon.png" width="1000"/>
</p>

å›ºä½“ä»‹ç”µå¸¸æ•°ã€ç”µå¯¼ç‡ã€æŠ˜å°„ç‡ä¸€èˆ¬æ¥è¯´éƒ½æ˜¯å¤æ•°ï¼ŒçŸ¥é“å…¶ä¸€å¯ä»¥ç¡®å®šå…¶ä½™ä¸¤ä¸ªï¼Œè¿›è€Œè¿˜å¯ä»¥å¾—åˆ°å¸æ”¶ç³»æ•°ï¼Œåå°„ç‡ï¼Œä¸‰è€…å…³ç³»å¦‚ä¸‹è¡¨[9]ï¼š

<p align="left">
    <img src="../../../../../img/optic_relation.png" width="1000"/>
</p>

å¸æ”¶ç³»æ•° $\alpha= \frac{2k \omega }{c}$

åå°„ç‡ $R=\frac{(1-n)^2+k^2}{(1+n)^2+k^2}$

## 4. å£°å­è°±çš„è®¡ç®—
è®¡ç®—GaAsçš„å£°å­è°±ã€‚QEä¸­å£°å­è®¡ç®—æ˜¯é€šè¿‡DFPTè¿›è¡Œçš„ï¼Œé€šè¿‡åŠ å…¥berry phaseç”µåœºè®¡ç®—ç”µè·å“åº”å¾—åˆ°ä»‹ç”µå¸¸æ•°ï¼Œæ–°ç‰ˆæœ¬ï¼ˆ>=6.xï¼‰ä¹Ÿå¼€å§‹æ”¯æŒfinite displacements methodã€‚å‚è€ƒå®‰è£…åŒ…q-e-qe-6.3\PHonon\examples\ example1 ï¼ˆ$\Gamma$ç‚¹ï¼‰å’Œexample2 ï¼ˆè‰²æ•£ï¼‰ï¼Œç”»å›¾è¿™é‡Œç”¨çš„æ˜¯pythonã€‚

é¦–å…ˆä¼˜åŒ–æ™¶æ ¼å¸¸æ•°ï¼Œç”¨pw.xè¿›è¡Œä¸€æ¬¡vc-relaxè®¡ç®—ï¼ˆæ™¶æ ¼å¸¸æ•°å®éªŒå€¼5.715Ã…ï¼Œè®¡ç®—å€¼5.585Ã…ï¼‰ã€‚GGAè®¡ç®—å‡ºçš„æåŒ–å¾€å¾€è¾ƒå®é™…åå¤§è€ŒLDAåå°ï¼Œåœ¨æåŒ–$4\pi P$æ¥è¿‘ç”µä½ç§»çŸ¢é‡Dæ—¶ä»‹ç”µå¸¸æ•°å‘æ•£ï¼ˆ$4\pi P$æ€»æ˜¯å°äºDï¼‰ï¼Œ$\epsilon=1+\frac{4\pi P}{D-4\pi P}$ï¼Œæ‰€ä»¥æåŒ–åå¤§å¯¹ä»‹ç”µå¸¸æ•°å½±å“è¾ƒå¤§ã€‚è¿™é‡ŒGaAsæŒ‰ç…§æ–‡çŒ®ä¸­çš„åšæ³•ä½¿ç”¨äº†LDAæ¨¡å®ˆæ’èµåŠ¿ï¼ŒèµåŠ¿æ–‡ä»¶è§[Ga](../../../../../img/Ga.SG15.LDA.UPF)ï¼Œ[As](../../../../../img/As.SG15.LDA.UPF)ã€‚

```
&CONTROL
    calculation='vc-relax', disk_io='low', prefix='pwscf',
    pseudo_dir='./', outdir='./tmp', verbosity='high'
    tprnfor=.true., tstress=.true., forc_conv_thr=1.0d-5, etot_conv_thr=1.0d-5
/
&SYSTEM
    ibrav= 2,
    celldm(1) = 10.7997848
    nat= 2, ntyp= 2,
    occupations = 'fixed', nbnd=10
    ecutwfc= 120, ecutrho = 480,
    input_dft='pz'
/
&ELECTRONS
    electron_maxstep = 100,    conv_thr = 1.0d-9,    mixing_mode = 'plain'
    mixing_beta = 0.7d0,    diagonalization = 'david'
/
&IONS
    ion_dynamics='bfgs'
/
&CELL
   press = 0.00 ,
   press_conv_thr=0.1
   cell_dynamics = 'bfgs' ,
/
ATOMIC_SPECIES
 Ga  69.7230 Ga.SG15.LDA.UPF
 As  74.9216 As.SG15.LDA.UPF
ATOMIC_POSITIONS (crystal)
Ga       0.000000000   0.000000000   0.000000000 0 0 0
As       0.250000000   0.250000000   0.250000000
K_POINTS {automatic}
11 11 11 1 1 1
```

### 4.1 å•ä¸ªqç‚¹çš„ph.xè®¡ç®—

vc-relaxè®¡ç®—ä¹‹åç”¨æœ€ç»ˆç»“æ„åšä¸€æ¬¡scfè®¡ç®—ï¼ˆå¦åˆ™åç»­è®¡ç®—ä¼šå‡ºé”™ï¼‰ã€‚

å°†ä»¥ä¸‹æ–‡ä»¶ä¿å­˜ä¸ºph.inpï¼Œè¿è¡Œ```ph.x < ph.inp > ph.out```

```
phonons of GaAs at Gamma
 &inputph
  tr2_ph=1.0d-14,
  prefix='pwscf',
  outdir='./tmp',
  epsil=.true.,
  amass(1)=69.7230,
  amass(2)=74.9216,
  fildyn='gs.dynG',
 /
0.0 0.0 0.0
```

åœ¨è¾“å‡ºph.outä¸­å¯ä»¥æ‰¾åˆ°é«˜é¢‘ä»‹ç”µå¸¸æ•°å¼ é‡$\epsilon_{ij}(\infty)$ï¼ˆå®éªŒå€¼10.86ï¼ŒRef.[10]ï¼‰ï¼Œä»¥åŠç»æ©æœ‰æ•ˆç”µè·å¼ é‡$Z_{ij}$ï¼ˆå®éªŒå€¼2.07ï¼‰ï¼š
```
          Dielectric constant in cartesian axis 

          (      13.578406136      -0.000000000       0.000000000 )
          (      -0.000000000      13.578406136      -0.000000000 )
          (       0.000000000      -0.000000000      13.578406136 )

          Effective charges (d Force / dE) in cartesian axis

           atom      1   Ga 
      Ex  (        2.04400        0.00000        0.00000 )
      Ey  (        0.00000        2.04400       -0.00000 )
      Ez  (        0.00000       -0.00000        2.04400 )
           atom      2   As 
      Ex  (       -2.04051       -0.00000       -0.00000 )
      Ey  (       -0.00000       -2.04051        0.00000 )
      Ez  (       -0.00000        0.00000       -2.04051 )
```

æ­¤æ—¶è®¡ç®—å‡º$\Gamma$ç‚¹å£°å­é¢‘ç‡ï¼š
```
     Diagonalizing the dynamical matrix

     q = (    0.000000000   0.000000000   0.000000000 )

 **************************************************************************
     freq (    1) =      -2.183574 [THz] =     -72.836200 [cm-1]
     freq (    2) =      -2.183574 [THz] =     -72.836200 [cm-1]
     freq (    3) =      -2.183574 [THz] =     -72.836200 [cm-1]
     freq (    4) =       7.777154 [THz] =     259.417942 [cm-1]
     freq (    5) =       7.777154 [THz] =     259.417942 [cm-1]
     freq (    6) =       7.777154 [THz] =     259.417942 [cm-1]
 **************************************************************************
```
ä½†æ˜¯ï¼Œå¯ä»¥çœ‹åˆ°ph.xè¾“å‡ºçš„$\Gamma$ç‚¹å£°å­¦å£°å­ä¸ç­‰äº0ï¼Œä¸”æ²¡æœ‰LO-TOåˆ†è£‚ã€‚åœ¨å£°å­å¹³è¡¡ä½ç½®ï¼Œç”±å¯¹ç§°æ€§å¯çŸ¥LOä¸TOæ˜¯ç®€å¹¶çš„ã€‚ä½†æ˜¯ï¼ŒLOä¸é•¿ç¨‹åº“ä»‘ä½œç”¨è€¦åˆè€ŒTOä¸è€¦åˆé€ æˆLO-TOåˆ†è£‚[11]ã€‚ä¸ºäº†åŠ å…¥Acoustic Sum Ruleå’Œnon-analytic termä¿®æ­£ï¼Œå°†ä»¥ä¸‹æ–‡ä»¶ä¿å­˜ä¸ºdynmat.inpï¼Œè¿è¡Œ```dynmat.x < dynmat.inp > dynmat.out```

```
&input
  fildyn='gs.dynG'
  q(1)=0,q(2)=0,q(3)=0.1
  asr='crystal'
  filout='dynmat.dat'
/
```

å…¶ä¸­ï¼Œq(1,2,3)æ˜¯LO-TOåˆ†è£‚çš„æ–¹å‘ï¼Œå¯¹äºç«‹æ–¹æ™¶ç³»å„å‘åŒæ€§ä¸å…¨ç­‰äº0å³å¯ã€‚dynmat.xåŠ å…¥äº†éè§£æé¡¹ä¿®æ­£ï¼Œå¯¹äºq=0ç‚¹åŠ å…¥äº†å£°å­¦å£°å­æ±‚å’Œè§„åˆ™ï¼Œå†æ¬¡å¯¹è§’åŒ–åŠ¨åŠ›å­¦çŸ©é˜µã€‚è¾“å‡ºçš„dynmat.outä¸­å¯ä»¥æ‰¾åˆ°$\Gamma$ç‚¹å£°å­é¢‘ç‡å¦‚ä¸‹ï¼ˆå®éªŒå€¼ï¼šTO=271$cm^{-1}$ï¼ŒLO=293$cm^{-1}$ï¼‰ã€‚ç¬¬ä¸‰åˆ—æ˜¯çº¢å¤–å¼ºåº¦ã€‚

```
# mode   [cm-1]    [THz]      IR
    1     -0.00   -0.0000    0.0000
    2      0.00    0.0000    0.0000
    3      0.00    0.0000    0.0000
    4    259.42    7.7771    2.6645
    5    259.42    7.7771    2.6645
    6    277.32    8.3139    2.6645
```

### 4.2 å£°å­è‰²æ•£è®¡ç®—
é¦–å…ˆï¼Œç”¨ph.xåœ¨qç‚¹ç½‘æ ¼ä¸Šé€šè¿‡DFPTè®¡ç®—åŠ¨åŠ›å­¦çŸ©é˜µï¼Œè¾“å…¥ph.inpå¦‚ä¸‹ï¼ˆéœ€è¦åœ¨scfè®¡ç®—ä¹‹åè¿è¡Œï¼Œå¦‚æœæ¥åœ¨vc-relaxä¹‹åè¿è¡Œph.xï¼Œè¿è¡Œq2r.xæ—¶ä¼šå‡ºé”™ï¼‰ï¼Œè¿è¡Œ```ph.x < ph.inp > ph.out```ï¼š

```
phonons of GaAs q-grid
 &inputph
  tr2_ph=1.0d-12,
  prefix='pwscf',
  outdir='./tmp',
  amass(1)=69.7230,
  amass(2)=74.9216,
  fildyn='gs666.dyn',
  ldisp=.true.,
  nq1=6, nq2=6, nq3=6
 /
```

ph.xè®¡ç®—ç»“æŸåï¼ˆè¿™ä¸€æ­¥è®¡ç®—é‡å¾ˆå¤§ï¼Œ24æ ¸ç®—äº†çº¦30å°æ—¶ï¼Œqç‚¹å¯èƒ½å–å¤šäº†ï¼Œæˆªæ–­èƒ½ä¹Ÿåå¤§äº†ğŸ¤”ï¼‰ç”¨q2r.xå°†åŠ¨åŠ›å­¦çŸ©é˜µç”±qç©ºé—´å˜æ¢åˆ°å®ç©ºé—´ï¼Œè¾“å…¥q2r.inpå¦‚ä¸‹ï¼Œè¿è¡Œ```q2r.x < q2r.inp > q2r.out```ï¼š
```
 &input
   fildyn='gs666.dyn', zasr='simple', flfrc='gs666.fc'
 /
```

matdyn.xé€šè¿‡å®ç©ºé—´nq1Ã—nq2Ã—nq3è¶…èƒä¸Šinteratomic force constantsè®¡ç®—ä»»æ„qç‚¹å£°å­é¢‘ç‡ã€‚å¯¹äºéç«‹æ–¹ææ–™å„é¡¹å¼‚æ€§çš„LO-TOåˆ†è£‚éœ€è¦å°†$\Gamma$ç‚¹å†™ä¸¤æ¬¡ï¼Œç«‹æ–¹ææ–™åˆ™ä¸éœ€è¦ã€‚å°†ä»¥ä¸‹ä¿å­˜ä¸ºmatdyn.inpï¼Œè¿è¡Œ```matdyn.x < matdyn.inp > matdyn.out```ï¼Œè®¡ç®—å£°å­è‰²æ•£ï¼Œqç‚¹å®šä¹‰è§å®‰è£…åŒ…[/Doc/brillouin_zones.pdf](https://github.com/QEF/q-e/blob/master/Doc/brillouin_zones.pdf)ã€‚

```
&input
  asr='simple',
  amass(1)=69.7230,
  amass(2)=74.9216,
  flfrc='gs666.fc',
  flfrq='gs.freq',
  q_in_band_form=.true.,
/
6
  gG    40
  X     10
  U      0
  K     40
  gG    40
  L     1
```
å£°å­è‰²æ•£è§ä¸‹å›¾ï¼Œç”»å›¾æ—¶è¦åˆ æ‰ç¬¬50ä¸ªï¼ˆUç‚¹ï¼‰å’Œç¬¬51ä¸ªï¼ˆKç‚¹ï¼‰qç‚¹ä¸­çš„ä¸€ä¸ªï¼Œç»“æœä¸æ–‡çŒ®ä¸­æ¯”è¾ƒè§[10]ã€‚matdyn.xä¹Ÿå¯ä»¥ç”¨æ¥è®¡ç®—å£°å­æ€å¯†åº¦ã€ç”µå£°å­è€¦åˆç³»æ•°ã€‚

<p align="left">
    <img src="../../../../../img/gaas_phonon.png" width="1000"/>
</p>

## 5. æ‚åŒ–æ³›å‡½å’ŒWannierå‡½æ•°

HSE06æ˜¯ä¸€ç§æ‚åŒ–æ³›å‡½ï¼ˆHybrid functionalï¼‰ï¼Œå…¶ä¸­äº¤æ¢ä½œç”¨çŸ­ç¨‹éƒ¨åˆ†ç”¨GGAå’ŒHatree-Fockçš„æ··åˆï¼Œé•¿ç¨‹éƒ¨åˆ†ä½¿ç”¨GGAï¼Œå…³è”åˆ™ç»Ÿä¸€ä½¿ç”¨GGAã€‚HSE06ç›¸å¯¹äºGGAè®¡ç®—ç»“æœï¼Œæ€»èƒ½å’ŒåŠ›çš„å‡†ç¡®åº¦æœ‰ç³»ç»Ÿæ€§çš„æå‡[12]ã€‚WannieråŸºå‡½æ•°æ˜¯ä¸å¹³é¢æ³¢åŸºå‡½æ•°å¯ä»¥ç›¸äº’å˜æ¢çš„å®Œå¤‡åŸºï¼Œæ˜¯ä¸€ç§å±€åŸŸè½¨é“åŸºå‡½æ•°[13]ã€‚

è®¡ç®—å‰éœ€è¦ç¼–è¯‘wannier90æ¨¡å—ï¼ŒQEç›®å½•è¿è¡Œ```make w90```ã€‚è¿™é‡Œå‚è€ƒå®‰è£…åŒ…ä¸­çš„ä¾‹å­q-e-qe-6.3/PW/examples/EXX_exampleä»¥åŠq-e-qe-6.3/W90/examples/example03å’Œexample05ã€‚

è®¡ç®—HSEèƒ½å¸¦æœ‰ä»¥ä¸‹å››æ­¥ï¼š
1. ç”¨pw.xè¿è¡Œâ€˜scfâ€™/â€˜nscfâ€™ã€‚
2. è¿è¡Œwannier90.x -pp (æˆ–è¾“å…¥æ–‡ä»¶å†…postproc_setup = .true.)ç”Ÿæˆseedname.nnkpã€‚
3. è¿è¡Œpw2wannier90.xè¯»å…¥pwè¾“å‡ºæ–‡ä»¶ã€seedname.pw2wanå’Œseedname.nnkp, ç”Ÿæˆseedname.mmn, seedname.amnå’Œseedname.eigã€‚
4. è¿è¡Œwannier90.xå¾—åˆ°èƒ½å¸¦ã€‚

### 5.1 æ‚åŒ–æ³›å‡½è‡ªæ´½è®¡ç®—

ç”¨HSE06è¿›è¡Œscfè®¡ç®—ï¼Œè¿è¡Œpw.xï¼Œè¾“å…¥å¦‚ä¸‹ï¼Œè¿™é‡Œé‡‡ç”¨äº†pslibrary1.0çš„è¶…è½¯èµåŠ¿ï¼Œé‡‡ç”¨äº†PBEçš„æ™¶æ ¼å¸¸æ•°ï¼ˆè§ç¬¬1.4èŠ‚ï¼‰ï¼Œä¹Ÿå¯ä»¥ç”¨HSE06åšvc-relaxæˆ–çŠ¶æ€æ–¹ç¨‹è®¡ç®—ï¼Œè®¡ç®—éœ€è¦å…³æ‰å¯¹ç§°æ€§ï¼Œå¾—åˆ°å®Œæ•´çš„kç½‘æ ¼ï¼ˆ4Ã—4Ã—4=64ä¸ªkç‚¹ï¼‰ï¼š
```
&CONTROL
    calculation='scf', disk_io='low', prefix='pwscf',
    pseudo_dir='./', outdir='./tmp', verbosity='high'
    tprnfor=.true., tstress=.true., forc_conv_thr=1.0d-5
/
&SYSTEM
    ibrav= 0,
    celldm(1) = 1.8897261328856432, ! a.u. to Angst
    nat= 2, ntyp= 2,
    occupations = 'smearing', smearing = 'gauss', degauss = 1.0d-9
    ecutwfc= 50, ecutrho = 500,
    input_dft='hse'
    exxdiv_treatment = 'gygi-baldereschi'
    ecutvcut = 0.7
    x_gamma_extrapolation = .true.
    nqx1=4, nqx2=4, nqx3=4,
nosym=.true.
nosym_evc=.true.
noinv=.true.
/
&ELECTRONS
    electron_maxstep = 100
    conv_thr = 1.0d-9
    mixing_mode = 'plain'
    mixing_beta = 0.8d0
    diagonalization = 'david'
/
&IONS
    ion_dynamics='bfgs'
/
&CELL
    press_conv_thr=0.1
/
ATOMIC_SPECIES
  Si 28.08550 Si.UPF
  C  12.01070 C.UPF
ATOMIC_POSITIONS (crystal)
Si       0.000000000   0.000000000   0.000000000
C        0.250000000   0.250000000   0.250000000
K_POINTS {automatic}
  4 4 4 0 0 0 
CELL_PARAMETERS (alat=  1.88972613)
   2.188890473   2.188890473   0.000000000
   0.000000000   2.188890473   2.188890473
   2.188890473   0.000000000   2.188890473
```

### 5.2 æå–Wannierå‡½æ•°å¹¶è®¡ç®—èƒ½å¸¦

è¾“å…¥æ–‡ä»¶sc.winå¦‚ä¸‹ï¼Œå…¶ä¸­```mp_grid      = 4 4 4```è¦ä¸HSE06çš„scfè®¡ç®—ä¸­kç‚¹ä¸€è‡´ï¼Œ```kpoints```é‡‡ç”¨pwè¾“å‡ºçš„kç‚¹ï¼Œè¿è¡Œ```wannier90.x -pp sc```ï¼š

```
num_bands         =   8      
num_wann          =   8

dis_win_max       = 17.0d0
dis_froz_max      =  6.4d0
dis_num_iter      =  120
dis_mix_ratio     = 1.d0

num_iter          = 50
num_print_cycles  = 10

Begin Atoms_Frac
Si       0.000000000   0.000000000   0.000000000
C        0.250000000   0.250000000   0.250000000
End Atoms_Frac
    
Begin Projections     
Si : sp3 
C  : sp3 
End Projections       
    
begin kpoint_path
L 0.50000  0.50000 0.5000 G 0.00000  0.00000 0.0000
G 0.00000  0.00000 0.0000 X 0.50000  0.00000 0.5000
X 0.50000 -0.50000 0.0000 K 0.37500 -0.37500 0.0000 
K 0.37500 -0.37500 0.0000 G 0.00000  0.00000 0.0000
end kpoint_path

!bands_plot = .true.

Begin Unit_Cell_Cart
   2.188890473   2.188890473   0.000000000
   0.000000000   2.188890473   2.188890473
   2.188890473   0.000000000   2.188890473
End Unit_Cell_Cart

mp_grid      = 4 4 4

begin kpoints
 0.0000000   0.0000000   0.0000000
 0.0000000   0.0000000   0.2500000
 0.0000000   0.0000000  -0.5000000
 0.0000000   0.0000000  -0.2500000
 0.0000000   0.2500000   0.0000000
 0.0000000   0.2500000   0.2500000
 0.0000000   0.2500000  -0.5000000
 0.0000000   0.2500000  -0.2500000
 0.0000000  -0.5000000   0.0000000
 0.0000000  -0.5000000   0.2500000
 0.0000000  -0.5000000  -0.5000000
 0.0000000  -0.5000000  -0.2500000
 0.0000000  -0.2500000   0.0000000
 0.0000000  -0.2500000   0.2500000
 0.0000000  -0.2500000  -0.5000000
 0.0000000  -0.2500000  -0.2500000
 0.2500000   0.0000000   0.0000000
 0.2500000   0.0000000   0.2500000
 0.2500000   0.0000000  -0.5000000
 0.2500000   0.0000000  -0.2500000
 0.2500000   0.2500000   0.0000000
 0.2500000   0.2500000   0.2500000
 0.2500000   0.2500000  -0.5000000
 0.2500000   0.2500000  -0.2500000
 0.2500000  -0.5000000   0.0000000
 0.2500000  -0.5000000   0.2500000
 0.2500000  -0.5000000  -0.5000000
 0.2500000  -0.5000000  -0.2500000
 0.2500000  -0.2500000   0.0000000
 0.2500000  -0.2500000   0.2500000
 0.2500000  -0.2500000  -0.5000000
 0.2500000  -0.2500000  -0.2500000
-0.5000000   0.0000000   0.0000000
-0.5000000   0.0000000   0.2500000
-0.5000000   0.0000000  -0.5000000
-0.5000000   0.0000000  -0.2500000
-0.5000000   0.2500000   0.0000000
-0.5000000   0.2500000   0.2500000
-0.5000000   0.2500000  -0.5000000
-0.5000000   0.2500000  -0.2500000
-0.5000000  -0.5000000   0.0000000
-0.5000000  -0.5000000   0.2500000
-0.5000000  -0.5000000  -0.5000000
-0.5000000  -0.5000000  -0.2500000
-0.5000000  -0.2500000   0.0000000
-0.5000000  -0.2500000   0.2500000
-0.5000000  -0.2500000  -0.5000000
-0.5000000  -0.2500000  -0.2500000
-0.2500000   0.0000000   0.0000000
-0.2500000   0.0000000   0.2500000
-0.2500000   0.0000000  -0.5000000
-0.2500000   0.0000000  -0.2500000
-0.2500000   0.2500000   0.0000000
-0.2500000   0.2500000   0.2500000
-0.2500000   0.2500000  -0.5000000
-0.2500000   0.2500000  -0.2500000
-0.2500000  -0.5000000   0.0000000
-0.2500000  -0.5000000   0.2500000
-0.2500000  -0.5000000  -0.5000000
-0.2500000  -0.5000000  -0.2500000
-0.2500000  -0.2500000   0.0000000
-0.2500000  -0.2500000   0.2500000
-0.2500000  -0.2500000  -0.5000000
-0.2500000  -0.2500000  -0.2500000
End Kpoints
```

ä»¥ä¸‹æ–‡ä»¶ä¿å­˜ä¸ºpw2wan.inpï¼Œè¿è¡Œ```pw2wannier90.x < pw2wan.inp > pw2wan.out```ï¼š

```
&inputpp
   outdir = './tmp'
   prefix = 'pwscf'
   seedname = 'sc'
   spin_component = 'none'
   write_mmn = .true.
   write_amn = .true.
   write_unk = .true.
/
```

å°†sc.winä¸­çš„```!bands_plot = .true.```æ³¨é‡Šå¹å·åˆ å»ï¼Œå†è¿è¡Œä¸€æ¬¡```wannier90.x sc```ï¼Œå¾—åˆ°wannieråŸºå‡½æ•°çš„èƒ½å¸¦å€¼sc_band.datï¼Œç”¨è¿™ä¸ªæ–‡ä»¶ç”»å›¾ï¼Œgnuplotè¾“å…¥æ–‡ä»¶å¦‚ä¸‹ï¼š

```
reset
set terminal pngcairo size 580,880 enhanced font 'Times-Roman,15'
set output "out.png"

set style data dots
set nokey

set label "SiC HSE06   Eg=2.15eV" at graph 0.05,graph 0.96

set xrange [0: 4.70794]
!set yrange [ -20.0 : 20.0]
set yrange [ -20 : 20]
set arrow from  1.24296,  -20.0 to  1.24296,  20.0 nohead
set arrow from  2.67820,  -20.0 to  2.67820,  20.0 nohead
set arrow from  3.18564,  -20.0 to  3.18564,  20.0 nohead
set xtics ("L"  0.00000,"{/Symbol G}"  1.24296,"X"  2.67820,"K"  3.18564,"{/Symbol G}"  4.70794)
 plot "sc_band.dat" using 1:($2-0.88318010E+01) with lines lt 1  lw 2 lc rgb "red"
```

ç»“æœå¦‚ä¸‹å›¾ï¼Œå¸¦éš™å€¼ä¸PBEï¼ˆè§1.4èŠ‚ï¼‰ç›¸æ¯”æœ‰æ‰€æå‡ã€‚

<p align="left">
    <img src="../../../../../img/sc_hseband.png" width="580"/>
</p>

## 6. æ³¢å‡½æ•°æŠ•å½±
>ä¸€å°ºä¹‹æ£°ï¼Œæ—¥å–å…¶åŠï¼Œä¸‡ä¸–ä¸ç«­ã€‚â€”â€”ã€Šåº„å­Â·å¤©ä¸‹ã€‹

QEè®¡ç®—çš„æ³¢å‡½æ•°æ˜¯ä»¥å¹³é¢æ³¢åŸºç»„è¡¨ç¤ºçš„ï¼Œè€ŒåŸå­è½¨é“æœ‰æ›´å¥½çš„ç›´è§‚æ€§å’Œå¯è§£é‡Šæ€§ï¼Œæ˜¯åˆ†æèƒ½å¸¦ä¸å¯æˆ–ç¼ºçš„æ‰‹æ®µï¼Œå¯ä»¥å°†å„ä¸ªkç‚¹çš„å„ä¸ªèƒ½çº§çš„æ³¢å‡½æ•°ï¼ŒæŠ•å½±åˆ°ä»¥å„ä¸ªåŸå­åæ ‡ä¸ºä¸­å¿ƒçš„sã€pã€dã€fç­‰çƒè°å‡½æ•°ä¸Šï¼ˆä»¥åŠéå…±çº¿å’Œç£æ€§è®¡ç®—ä¸­çš„è‡ªæ—‹ï¼‰ï¼Œå³ä¸ºï¼ˆlocalï¼‰projected density of statesï¼Œç”¨projwfc.xæ¨¡å—è®¡ç®—ï¼Œä¸‹é¢ä»¥$SnO_{2}$(rutile)çš„æŠ•å½±æ€å¯†åº¦ä¸ºä¾‹ã€‚

åšvc-relaxï¼Œè¾“å…¥æ–‡ä»¶å¦‚ä¸‹ï¼š

```Fortran
&CONTROL
    calculation='vc-relax', disk_io='low', prefix='pwscf',
    pseudo_dir='./', outdir='./tmp', verbosity='high'
    tprnfor=.true., tstress=.true., forc_conv_thr=1.0d-5, etot_conv_thr=1.0d-5, nstep=100,
/
&SYSTEM
    ibrav= 6,
    celldm(1)=8.952142,
    celldm(3)=0.672620,
    nat= 6,
    ntyp= 2,
    occupations = 'fixed', nbnd=32,
    ecutwfc= 100, ecutrho = 1200,
/
&ELECTRONS
    electron_maxstep = 100,    conv_thr = 1.0d-9,    mixing_mode = 'plain'
    mixing_beta = 0.7d0,    diagonalization = 'david'
/
&IONS
    ion_dynamics='bfgs'
/
&CELL
   press = 0.00 ,
   press_conv_thr=0.1
   cell_dynamics = 'bfgs' ,
/
ATOMIC_SPECIES
  Sn 118.710  Sn.pbe-dn-rrkjus_psl.1.0.0.UPF
  O   15.999  O.pbe-n-rrkjus_psl.1.0.0.UPF
ATOMIC_POSITIONS (crystal)
Sn  0.000000   0.000000   0.000000
Sn  0.500000   0.500000   0.500000
O   0.307000   0.307000   0.000000
O  -0.307000  -0.307000   0.000000
O   0.193000   0.807000   0.500000
O   0.807000   0.193000   0.500000
K_POINTS {automatic}
  6 6 9 0 0 0
```

è®¡ç®—DOSéœ€è¦è¾ƒå¯†çš„kç‚¹ï¼Œå†åšä¸€æ¬¡nscfè®¡ç®—ï¼Œkç‚¹è®¾ç½®ä¸º

```
K_POINTS {automatic}
  13 13 20 0 0 0
```

ä»¥ä¸‹æ–‡ä»¶ä¿å­˜ä¸ºproj.inpï¼Œè¿è¡Œ```mpirun projwfc.x <proj.inp >proj.out```ã€‚

```Fortran
&PROJWFC
prefix='pwscf',
outdir='./tmp',
ngauss=0,
degauss=0.01,
DeltaE=0.005
lsym=.true.
filpdos='sno',
filproj='sno',
/
```

ç”¨ä»¥ä¸‹Pythonç¨‹åºç”»å›¾ï¼š

```python
#!/bin/env python
# -*- coding: utf-8 -*-

import matplotlib as mpl
mpl.use('Agg')
import matplotlib.pyplot as plt
import numpy as np

lw=1.2

F=plt.gcf()
F.clf()
p=plt.subplot(1, 1, 1)

# change by-hand here, read scf input in the future
elem=['Sn','O']
ielem=np.array([2,4],dtype=np.int32) # number of atoms for each element
orb=[['s','p','d'],['s','p']]  # projectors for each element
iorb=np.array([3,2],dtype=np.int32) # number of projectors for each element

num_file=np.dot(ielem,iorb)
nat=np.sum(ielem)
D=[]
N=len(elem)

#scf ATOMIC_POSITIONS should be sorted in the same order as above
count=0
count_at=0
for n in range(N):
    for i in range(ielem[n]):
        for j in range(iorb[n]):
            print(n,i,j,count_at+1,elem[n],j+1,orb[n][j])
            fname='sno.pdos_atm#{}({})_wfc#{}({})'.format(count_at+1,elem[n],j+1,orb[n][j])
            D.append(np.loadtxt(fname,dtype=np.float32))
            count+=1
        count_at+=1

e_fermi=8.7233
line1=plt.plot(D[0][:,0]-e_fermi,D[0][:,1]+D[3][:,1],color='g',linewidth=lw,label='Sn s' )
line2=plt.plot(D[0][:,0]-e_fermi,D[1][:,1]+D[4][:,1],color='r',linewidth=lw,label='Sn p' )
line3=plt.plot(D[0][:,0]-e_fermi,D[2][:,1]+D[5][:,1],color='b',linewidth=lw,label='Sn d' )

line4=plt.plot(D[0][:,0]-e_fermi,D[6][:,1]+D[8][:,1]+D[10][:,1]+D[12][:,1],color='cyan',linewidth=lw,label='O s' )
line5=plt.plot(D[0][:,0]-e_fermi,D[7][:,1]+D[9][:,1]+D[11][:,1]+D[13][:,1],color='grey',linewidth=lw,label='O p' )
plt.xlim([-10,7])
plt.ylim([0,10.5])

plt.ylabel(r'DOS (a.u.)',fontsize=16)
plt.xlabel(r'E (eV) ',fontsize=16)
plt.legend()
plt.savefig('pdos.png',dpi=200)
```

ç»“æœå¦‚å›¾æ‰€ç¤ºã€‚
<p align="left">
    <img src="../../../../../img/sno_pdos.png" width="1000"/>
</p>


åœ¨èƒ½å¸¦è®¡ç®—ä¹‹åï¼Œç”¨projwfc.xç”Ÿæˆçš„sno.projwfc_upæ–‡ä»¶ï¼Œå¯ä»¥å’Œbands.xç”Ÿæˆçš„æ–‡ä»¶bd.datç»“åˆç”»å‡ºå„ä¸ªèƒ½å¸¦çš„åŸå­è½¨é“æŠ•å½±ï¼Œ
èƒ½å¸¦è®¡ç®—å°†è¾“å…¥kç‚¹è®¾ç½®ä¸ºï¼š
```
K_POINTS {crystal_b}
3
M 30
gG 30
Z 0
```
ä¾æ¬¡è¿è¡Œpw.xã€projwfc.xï¼Œç”»å›¾è„šæœ¬å¦‚ä¸‹ï¼š

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import numpy as np

ymin=-25
ymax=10
dline=30 # vertical line intervals
lw=0.5 # line width
nband=26

feig=open('bd.dat')
l=feig.readline()
nbnd=int(l.split(',')[0].split('=')[1])
nks=int(l.split(',')[1].split('=')[1].split('/')[0])

eig=np.zeros((nks,nbnd),dtype=float)
for i in range(nks):
    l=feig.readline()
    count=0
    for j in range(nbnd//10+1):
        l=feig.readline()
        for k in range(len(l.split())):
            eig[i][count]=l.split()[k]
            count=count+1
            
feig.close()

import matplotlib as mpl
mpl.use('Agg')
import matplotlib.pyplot as plt

F=plt.gcf()
F.set_size_inches([5,5])
p1=plt.subplot(1, 1, 1)

eig_vbm=max(eig[:,nband-1])
for i in range(nbnd):
    line1=plt.plot(np.arange(0,nks), eig[:,i]-eig_vbm,color='grey',linewidth=lw ) 

vline=dline
while vline<nks-1:
    plt.axvline(x=vline, ymin=ymin, ymax=ymax,linewidth=lw,color='black')
    vline=vline+dline


elem=['Sn','O']
ielem=np.array([2,4],dtype=np.int32) # number of atoms for each element
orb=[['s','p','d'],['s','p']]  # projectors for each element

N=len(elem)
iorb=np.zeros([N,],dtype=np.int32)  # number of projectors for each element
for i in range(N):
    iorb[i]=len(orb[i])

lorb=np.zeros([N,],dtype=np.int32) # number of local orbital for each element
for i in range(N):
    for j in orb[i]:
        if j is 's':
            lorb[i]+=1
        elif j is 'p':
            lorb[i]+=3
        elif j is 'd':
            lorb[i]+=5
        elif j is 'f':
            lorb[i]+=7
        else:
            print("unexpect: ",j)
            assert False

nlorb=np.dot(ielem,lorb)

pjsum=np.zeros([nlorb, nks, nbnd], dtype=np.float32)

filproj=open('sno.projwfc_up')
nline_io_header=14

for i in range(nline_io_header):
    filproj.readline()

for i in range(nlorb):
    filproj.readline()
    for j in range(nks):
        for k in range(nbnd):
            pjsum[i,j,k]=float(filproj.readline().split()[2])

nplotline=np.sum(iorb) 
#grep '[a-zA-Z]' sno.projwfc_up |grep 2P|awk '{printf( $1-1",")}'
oo=[[0,9],
[1,2,3,10,11,12],
[4,5,6,7,8,13,14,15,16,17],
[18,22,26,30],
[19,20,21,23,24,25,27,28,29,31,32,33]]

s_of_o=np.zeros([nks,],dtype=np.float32)
color=['r','g','orange','cyan','blue']
label=['Sn s','Sn p','Sn d','O s','O p']

scale=10.0
st=[]
for i in range(len(oo)):
    for k in range(nbnd):
        s_of_o=np.zeros([nks,],dtype=np.float32)
        for j in oo[i]:
            s_of_o[:]+=pjsum[j,:,k]
        if k==0:
            st.append(plt.scatter(np.arange(0,nks), eig[:,k]-eig_vbm, s=scale*s_of_o, c=color[i], alpha=0.4, label=label[i]))
        else:
            st.append(plt.scatter(np.arange(0,nks), eig[:,k]-eig_vbm, s=scale*s_of_o, c=color[i], alpha=0.4))

plt.xlim([0,nks-1]) # 201 points
plt.ylim([ymin,ymax])
plt.ylabel(r' E (eV) ',fontsize=16)
plt.xticks((0,30,60), ('M', r'${\Gamma}$', 'Z') )


plt.subplots_adjust(left=0.15, right=0.8, top=0.95, bottom=0.1)
p1.legend(scatterpoints =1, numpoints=1,markerscale=2.0, bbox_to_anchor=(1.05, 1), loc='upper left', borderaxespad=0.)

plt.savefig('pjband.png',dpi=500)
```

ç»“æœå¦‚å›¾æ‰€ç¤ºã€‚
<p align="left">
    <img src="../../../../../img/sno_pjband.png" width="1000"/>
</p>

å¦å¤–åœ¨PPç›®å½•ä¸‹æœ‰sumpdos.xå’Œplotproj.xä¸¤ä¸ªå·¥å…·ã€‚

## References

1. https://avogadro.cc/docs/building-materials/reducing-crystals-to-primitive-cells/

2. https://www.researchgate.net/post/How_to_convert_a_conventional_cell_to_a_primitive_cell 

3. Bilbao, http://www.cryst.ehu.es/cryst/celltran.html

4. Wahyu Setyawan, Stefano Curtarolo, High-throughput electronic band structure calculations: Challenges and tools. Computational Materials Science 49 (2010) 299â€“312.(doi:[10.1016/j.commatsci.2010.05.010](https://www.sciencedirect.com/science/article/pii/S0927025610002697)).

5. http://www.ioffe.ru/SVA/NSM/Semicond/SiC/bandstr.html

6. Sgiarovello, C., Binggeli, N., Baldereschi, A. (2004). Surface morphology and ionization potentials of polar semiconductors: The case of GaAs. Physical Review B, 69(3). doi:[10.1103/PhysRevB.69.035320](http://dx.doi.org/10.1103/PhysRevB.69.035320).

7. F. Bassani, G. Parravicini, Electronic states and optical transitions in solids. Pergamon Press (1975).

8. Anna Tararan et al. *Optical gap and optically active intragap defects in cubic BN*. [Phys. Rev. B 98, 094106 (2018).](http://dx.doi.org/10.1103/PhysRevB.98.094106)

9. Martin Dressel, George Gruner, *Electrodynamics of Solids-Optical Properties of Electrons in Matter*. Cambridge University Press (2002).

10. P. Giannozzi et al, *Ab initio calculation of phonon dispersions in semiconductors.* [Phys. Rev. B **43**, 7231 (1991).](http://dx.doi.org/10.1103/PhysRevB.43.7231). L. Lindsay et al, *Ab initio thermal transport in compound semiconductors.* [Physical Review B **87**,165201 (2013)](http://dx.doi.org/10.1103/PhysRevB.87.165201).

11. P.Y. Yu, M. Cardona, *Fundamentals of Semiconductors: Physics and Materials Properties*, Springer, 2010.

12. J. Paier et al, Screened hybrid density functionals applied to solids, The Journal of Chemical Physics 124, 154709 (2006); doi: [10.1063/1.2187006](http://dx.doi.org/10.1063/1.2187006).

13. Marzari et al, Maximally localized Wannier functions: Theory and applications, [Rev. Mod. Phys. **84**, 1419 (2012)](https://link.aps.org/doi/10.1103/RevModPhys.84.1419).


Update On 2019/09/05

